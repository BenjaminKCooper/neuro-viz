<!--
@license
Copyright (c) 2016 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
-->

<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="shared-styles.html">

<dom-module id="my-neuroviz2">
  <template>
    <style include="shared-styles">
      :host {
        display: block;

        padding: 10px;
      }
    </style>
  </template>
  <script src="../bower_components/three.js/build/three.js"></script>
  <script src="../bower_components/three.js/examples/js/loaders/OBJLoader.js"></script>
  <script src="../bower_components/three.js/examples/js/renderers/SVGRenderer.js"></script>
  <script src="../bower_components/three.js/examples/js/renderers/Projector.js"></script>



  		<script>
  			var stats;
  			var camera, scene;
  			var renderer;
  			var mesh;
  			var texture, texture1, texture2, texture3;
  			init();
  			animate();
  			function init() {
  				var width = window.innerWidth ;
  				var height = window.innerHeight;
  				camera = new THREE.PerspectiveCamera( 75, window.innerWidth/window.innerHeight, 0.1, 1000 );
  				camera.position.z = 2000;
  				scene = new THREE.Scene();

          var gridHelper = new THREE.GridHelper( 200, 40, 0x0000ff, 0x808080 );
				gridHelper.position.y = - 150;
				gridHelper.position.x = - 150;
				scene.add( gridHelper );
  				var textureLoader = new THREE.TextureLoader();
  				// MESH - Repeat Pattern
  				texture = textureLoader.load( '../src/models/UV_Grid_Sm.jpg' );
  				texture.wrapS = THREE.RepeatWrapping;
  				texture.wrapT = THREE.RepeatWrapping;
  				var geometry = new THREE.BoxGeometry( 150, 150, 150, 4, 4, 4 );
  				var material = new THREE.MeshBasicMaterial( { map: texture, overdraw: 0.5 } );
  				mesh = new THREE.Mesh( geometry, material );
  				scene.add( mesh );
  				// SPRITES - from Sprite Sheet
  				texture1 = textureLoader.load( '../src/models/UV_Grid_Sm.jpg', function() {
  					texture1.wrapS = THREE.ClampToEdgeWrapping;
  					texture1.wrapT = THREE.ClampToEdgeWrapping;
  					for ( var i = 0; i < 20; i ++ ) {
  						var tex = texture1.clone();
  						tex.needsUpdate = true; // cloning does not set this
  						tex.offset.x = 0.1 * THREE.Math.randInt( 0, 7 );
  						tex.offset.y = 0.1 * THREE.Math.randInt( 0, 7 );
  						tex.repeat.x = 0.1 * THREE.Math.randInt( 1, 3 );
  						tex.repeat.y = 0.1 * THREE.Math.randInt( 1, 3 );
  						var material = new THREE.SpriteMaterial( { map: tex } );
  						material.rotation = 0.5 * Math.PI * ( Math.random() - 0.5 );
  						var sprite = new THREE.Sprite( material );
  						sprite.position.x = Math.random() * 1000 - 500;
  						sprite.position.y = Math.random() * 1000 - 500;
  						sprite.position.z = Math.random() * 1000 - 500;
  						sprite.scale.set( 96, 96, 1 );
  						scene.add( sprite );
  					}
  				} );
  				// SPRITES - Repeat Pattern
  				texture2 = textureLoader.load( '../src/models/UV_Grid_Sm.jpg' );
  				texture2.wrapS = THREE.RepeatWrapping;
  				texture2.wrapT = THREE.RepeatWrapping;
  				for ( var i = 0; i < 20; i ++ ) {
  					var material = new THREE.SpriteMaterial( { map: texture2, opacity: 0.7 } );
  					var sprite = new THREE.Sprite( material );
  					sprite.material.rotation = 0.5 * Math.PI * ( Math.random() - 0.5 );
  					sprite.position.x = Math.random() * 1000 - 500;
  					sprite.position.y = Math.random() * 1000 - 500;
  					sprite.position.z = Math.random() * 1000 - 500;
  					sprite.scale.set( 64, 64, 1 );
  					scene.add( sprite );
  				}
  				// SPRITES - PNG
  				texture3 = textureLoader.load( '../src/models/UV_Grid_Sm.jpg' );
  				texture3.wrapS = THREE.ClampToEdgeWrapping;
  				texture3.wrapT = THREE.ClampToEdgeWrapping;
  				for ( var i = 0; i < 20; i ++ ) {
  					var material = new THREE.SpriteMaterial( { map: texture3 } );
  					material.rotation = 2 * Math.PI * ( Math.random() - 0.5 );
  					var sprite = new THREE.Sprite( material );
  					sprite.position.x = Math.random() * 1000 - 500;
  					sprite.position.y = Math.random() * 1000 - 500;
  					sprite.position.z = Math.random() * 1000 - 500;
  					sprite.scale.set( 64, 64, 1 );
  					scene.add( sprite );
  				}
  				//

          renderer = new THREE.WebGLRenderer( { antialias: true } );
				  renderer.setClearColor( 0xf0f0f0 );
				  renderer.setPixelRatio( window.devicePixelRatio );
				  renderer.setSize( window.innerWidth, window.innerHeight );
				  document.body.appendChild( renderer.domElement );

  				    //
  				window.addEventListener( 'resize', onWindowResize, false );
  			}
  			function onWindowResize() {
          camera.aspect = window.innerWidth / window.innerHeight;
          camera.updateProjectionMatrix();
          renderer.setSize( window.innerWidth, window.innerHeight );
  			}
  			//
  			function animate() {
  				requestAnimationFrame( animate );
  				render();
  			}
  			function render() {
  				var time = performance.now() * 0.0001;
  				camera.position.x = Math.sin( time ) * 500;
  				camera.position.z = Math.cos( time ) * 500;
  				camera.lookAt( scene.position );
  				//
  				texture.repeat.x = Math.sin( time ) * 0.5 + 1.0;
  				texture.repeat.y = Math.cos( time ) * 0.5 + 1.0;
  				texture.offset.x = Math.sin( time ) * 0.5 + 0.5;
  				texture.offset.y = Math.cos( time ) * 0.5 + 0.5;
  				mesh.rotation.x = time * 2;
  				mesh.rotation.y = time * 4;
  				//
  				texture2.repeat.x = Math.sin( time ) + 1.25;
  				texture2.repeat.y = Math.sin( time ) + 1.25;
  				texture2.offset.x = Math.sin( time );
  				texture2.offset.y = Math.cos( time );
  				//
  				renderer.render( scene, camera );
  			}
  		</script>
  <script>
    Polymer({
      is: 'my-neuroviz2'
    });
  </script>
</dom-module>
