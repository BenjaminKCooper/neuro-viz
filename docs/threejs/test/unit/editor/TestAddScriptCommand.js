module("AddScriptCommand"),test("Test AddScriptCommand (Undo and Redo)",function(){var e=new Editor,t=aBox("The scripted box"),n=aSphere("The scripted sphere"),o=[t,n],d={name:"",source:"function update( event ) { this.position.x = this.position.x + 1; }"},r={name:"",source:"function update( event ) { this.position.y = this.position.y + 1; }"},i=[d,r];o.map(function(t){e.execute(new AddObjectCommand(t))}),ok(2==e.scene.children.length,"OK, the box and the sphere have been added");for(var s=0;s<i.length;s++){var c=new AddScriptCommand(o[s],i[s]);c.updatable=!1,e.execute(c)}var a=Object.keys(e.scripts);ok(getScriptCount(e)==i.length,"OK, correct number of scripts have been added");for(var s=0;s<o.length;s++)ok(o[s].uuid==a[s],"OK, script key #"+s+" matches the object's UUID");e.undo(),ok(getScriptCount(e)==i.length-1,"OK, one script has been removed by undo"),e.redo(),ok(getScriptCount(e)==i.length,"OK, one script has been added again by redo");for(var s=0;s<a.length;s++)ok(e.scripts[a[s]][0]==i[s],"OK, script #"+s+" is still assigned correctly")});