module("Serialization"),test("Test Serialization",function(e){function t(){for(var e=0;e<y.length;e++){var t=y[e]();a.history.goToState(0),a.history.goToState(1e3);var o=JSON.stringify(a.history.toJSON());a.history.clear(),a.history.fromJSON(JSON.parse(o)),a.history.goToState(0),a.history.goToState(1e3);var r=JSON.stringify(a.history.toJSON());ok(o==r,"OK, forward serializing was successful for "+t),a.clear()}for(var e=0;e<y.length;e++){var t=y[e]();a.history.goToState(0);var o=JSON.stringify(a.history.toJSON());a.history.clear(),a.history.fromJSON(JSON.parse(o)),a.history.goToState(1e3),a.history.goToState(0);var r=JSON.stringify(a.history.toJSON());ok(o==r,"OK, backward serializing was successful for "+t),a.clear()}}var a=new Editor,o=e.async();a.storage.init(function(){t(),o()});var r=12581843,n=function(){var e=aBox("The Box"),t=new AddObjectCommand(e);return t.updatable=!1,a.execute(t),"addObject"},i=function(){var e=aBox("The Box"),t=new AddObjectCommand(e);a.execute(t);var t=new AddScriptCommand(e,{name:"test",source:'console.log("hello world");'});return t.updatable=!1,a.execute(t),"addScript"},d=function(){var e="Anakin Skywalker",t="Luke Skywalker",o=aSphere(e),r=aBox(t);return a.execute(new AddObjectCommand(o)),a.execute(new AddObjectCommand(r)),a.execute(new MoveObjectCommand(r,o)),"moveObject"},c=function(){var e=aBox("Box with no script");a.execute(new AddObjectCommand(e));var t={name:"test",source:'console.log("hello world");'},o=new AddScriptCommand(e,t);return o.updatable=!1,a.execute(o),o=new RemoveScriptCommand(e,t),a.execute(o),"removeScript"},u=function(){var e=aPointlight("The light Light");a.execute(new AddObjectCommand(e));var t=new SetColorCommand(e,"color",r);return t.updatable=!1,a.execute(t),"setColor"},m=function(){var e=aBox("Guinea Pig"),t={geometry:{parameters:{width:200,height:201,depth:202,widthSegments:2,heightSegments:3,depthSegments:4}}};a.execute(new AddObjectCommand(e));var o=new SetGeometryCommand(e,getGeometry("BoxGeometry",t));return o.updatable=!1,a.execute(o),"setGeometry"},l=function(){var e=aBox("Geometry Value Box");return a.execute(new AddObjectCommand(e)),cmd=new SetGeometryValueCommand(e,"uuid",THREE.Math.generateUUID()),cmd.updatable=!1,a.execute(cmd),"setGeometryValue"},w=function(){var e=aSphere("The Sun");a.execute(new AddObjectCommand(e));var t=new THREE.MeshPhongMaterial,o=new SetMaterialCommand(e,t);return o.updatable=!1,a.execute(o),"setMaterial"},S=function(){var e=aBox("Box with colored material");a.execute(new AddObjectCommand(e));var t=new SetMaterialColorCommand(e,"color",r);return t.updatable=!1,a.execute(t),"setMaterialColor"},s=function(){var e=aSphere("Sphere with texture");a.execute(new AddObjectCommand(e));var t="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAMAAAAoLQ9TAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyRpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMy1jMDExIDY2LjE0NTY2MSwgMjAxMi8wMi8wNi0xNDo1NjoyNyAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENTNiAoTWFjaW50b3NoKSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDpDMjYxMEI4MzVENDMxMUU1OTdEQUY4QkNGNUVENjg4MyIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDpDMjYxMEI4NDVENDMxMUU1OTdEQUY4QkNGNUVENjg4MyI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOkMyNjEwQjgxNUQ0MzExRTU5N0RBRjhCQ0Y1RUQ2ODgzIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOkMyNjEwQjgyNUQ0MzExRTU5N0RBRjhCQ0Y1RUQ2ODgzIi8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+txizaQAAABVQTFRFh4eHbGxsdFhEWT0puYVclmxKeVU6ppwr+AAAAHtJREFUeNosjgEWBCEIQplFuP+RB5h9lZn2EZxkLzC3D1YSgSlmk7i0ctzDZNBz/VSoX1KwjlFI8WmA2R7JqUa0LJJcd1rLNWRRaMyi+3Y16qMKHhdE48XLsDyHKJ0nSMazY1fxHyriXxV584tmEedcfGNrA/5cmK8AAwCT9ATehDDyzwAAAABJRU5ErkJggg==",o=new Image;o.src=t;var r=new THREE.Texture(o,"map");r.sourceFile="dirt.png";var n=new SetMaterialMapCommand(e,"map",r);return n.updatable=!1,a.execute(n),"setMaterialMap"},A=function(){var e=aBox("Box with values");a.execute(new AddObjectCommand(e));var t=new SetMaterialValueCommand(e,"name","Bravo");return t.updatable=!1,a.execute(t),"setMaterialValue"},h=function(){var e=aSphere("Sphere with position");a.execute(new AddObjectCommand(e));var t=new THREE.Vector3(101,202,303),o=new SetPositionCommand(e,t);return o.updatable=!1,a.execute(o),"setPosition"},x=function(){var e=aBox("Box with rotation");a.execute(new AddObjectCommand(e));var t=new THREE.Euler(.3,-1.7,2),o=new SetRotationCommand(e,t);return o.updatable=!1,a.execute(o),"setRotation"},b=function(){var e=aSphere("Sphere with scale");a.execute(new AddObjectCommand(e));var t=new THREE.Vector3(1.2,3.3,4.6),o=new SetScaleCommand(e,t);return o.updatable=!1,a.execute(o),"setScale"},p=function(){var e=aBox("Box with script");a.execute(new AddObjectCommand(e));var t={name:"Alert",source:"alert( null );"};a.execute(new AddScriptCommand(e,t));var o={name:"Console",source:"console.log( null );"},r=new SetScriptValueCommand(e,t,"source",o.source,0);return r.updatable=!1,a.execute(r),"setScriptValue"},v=function(){var e=aSphere("Sphere with UUID");a.execute(new AddObjectCommand(e));var t=new SetUuidCommand(e,THREE.Math.generateUUID());return t.updatable=!1,a.execute(t),"setUuid"},g=function(){var e=aBox("Box with value");a.execute(new AddObjectCommand(e));var t=new SetValueCommand(e,"intensity",2.3);return t.updatable=!1,a.execute(t),"setValue"},y=[n,i,d,c,u,m,l,w,S,s,A,h,x,b,p,v,g]});