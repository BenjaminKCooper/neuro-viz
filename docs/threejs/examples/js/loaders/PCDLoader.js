THREE.PCDLoader=function(e){this.manager=void 0!==e?e:THREE.DefaultLoadingManager,this.littleEndian=!0},Object.assign(THREE.PCDLoader.prototype,THREE.EventDispatcher.prototype,{load:function(e,t,r,i){var n=this,a=new THREE.FileLoader(n.manager);a.setResponseType("arraybuffer"),a.load(e,function(r){t(n.parse(r,e))},r,i)},binarryToStr:function(e){for(var t="",r=new Uint8Array(e),i=0;i<e.byteLength;i++)t+=String.fromCharCode(r[i]);return t},parseHeader:function(e){var t={},r=e.search(/[\r\n]DATA\s(\S*)\s/i),i=/[\r\n]DATA\s(\S*)\s/i.exec(e.substr(r-1));if(t.data=i[1],t.headerLen=i[0].length+r,t.str=e.substr(0,t.headerLen),t.str=t.str.replace(/\#.*/gi,""),t.version=/VERSION (.*)/i.exec(t.str),null!=t.version&&(t.version=parseFloat(t.version[1])),t.fields=/FIELDS (.*)/i.exec(t.str),null!=t.fields&&(t.fields=t.fields[1].split(" ")),t.size=/SIZE (.*)/i.exec(t.str),null!=t.size&&(t.size=t.size[1].split(" ").map(function(e){return parseInt(e,10)})),t.type=/TYPE (.*)/i.exec(t.str),null!=t.type&&(t.type=t.type[1].split(" ")),t.count=/COUNT (.*)/i.exec(t.str),null!=t.count&&(t.count=t.count[1].split(" ").map(function(e){return parseInt(e,10)})),t.width=/WIDTH (.*)/i.exec(t.str),null!=t.width&&(t.width=parseInt(t.width[1])),t.height=/HEIGHT (.*)/i.exec(t.str),null!=t.height&&(t.height=parseInt(t.height[1])),t.viewpoint=/VIEWPOINT (.*)/i.exec(t.str),null!=t.viewpoint&&(t.viewpoint=t.viewpoint[1]),t.points=/POINTS (.*)/i.exec(t.str),null!=t.points&&(t.points=parseInt(t.points[1],10)),null==t.points&&(t.points=t.width*t.height),null==t.count){t.count=[];for(var n=0;n<t.fields;n++)t.count.push(1)}t.offset={};for(var a=0,n=0;n<t.fields.length;n++)"ascii"==t.data?t.offset[t.fields[n]]=n:(t.offset[t.fields[n]]=a,a+=t.size[n]);return t.rowSize=a,t},parse:function(e,t){var r=this.binarryToStr(e),i=this.parseHeader(r),n=!1;void 0!=i.offset.x&&(n=new Float32Array(3*i.points));var a=!1;void 0!=i.offset.rgb&&(a=new Float32Array(3*i.points));var o=!1;if(void 0!=i.offset.normal_x&&(o=new Float32Array(3*i.points)),"ascii"==i.data)for(var s=i.offset,l=r.substr(i.headerLen),d=l.split("\n"),p=0,f=0;f<d.length;f++,p+=3){var u=d[f].split(" ");if(void 0!=s.x&&(n[p+0]=parseFloat(u[s.x]),n[p+1]=parseFloat(u[s.y]),n[p+2]=parseFloat(u[s.z])),void 0!=s.rgb){var h=new Float32Array([parseFloat(u[s.rgb])]),c=new DataView(h.buffer,0);a[p+0]=c.getUint8(0)/255,a[p+1]=c.getUint8(1)/255,a[p+2]=c.getUint8(2)/255}void 0!=s.normal_x&&(o[p+0]=parseFloat(u[s.normal_x]),o[p+1]=parseFloat(u[s.normal_y]),o[p+2]=parseFloat(u[s.normal_z]))}if("binary_compressed"==i.data)return void console.error("THREE.PCDLoader: binary_compressed files are not supported");if("binary"==i.data)for(var v=0,c=new DataView(e,i.headerLen),f=0,s=i.offset,p=0;f<i.points;p+=3,v+=i.rowSize,f++)void 0!=s.x&&(n[p+0]=c.getFloat32(v+s.x,this.littleEndian),n[p+1]=c.getFloat32(v+s.y,this.littleEndian),n[p+2]=c.getFloat32(v+s.z,this.littleEndian)),void 0!=s.rgb&&(a[p+0]=c.getUint8(v+s.rgb+0)/255,a[p+1]=c.getUint8(v+s.rgb+1)/255,a[p+2]=c.getUint8(v+s.rgb+2)/255),void 0!=s.normal_x&&(o[p+0]=c.getFloat32(v+s.normal_x,this.littleEndian),o[p+1]=c.getFloat32(v+s.normal_y,this.littleEndian),o[p+2]=c.getFloat32(v+s.normal_z,this.littleEndian));var E=new THREE.BufferGeometry;0!=n&&E.addAttribute("position",new THREE.BufferAttribute(n,3)),0!=a&&E.addAttribute("color",new THREE.BufferAttribute(a,3)),0!=o&&E.addAttribute("normal",new THREE.BufferAttribute(o,3)),E.computeBoundingSphere();var g=new THREE.PointsMaterial({size:.005,vertexColors:!(0==a)});0==a&&g.color.setHex(16777215*Math.random());var w=new THREE.Points(E,g),b=t.split("").reverse().join("");return b=/([^\/]*)/.exec(b),b=b[1].split("").reverse().join(""),w.name=b,w.PCDheader=i,w}});