THREE.SceneLoader=function(e){this.onLoadStart=function(){},this.onLoadProgress=function(){},this.onLoadComplete=function(){},this.callbackSync=function(){},this.callbackProgress=function(){},this.geometryHandlers={},this.hierarchyHandlers={},this.addGeometryHandler("ascii",THREE.JSONLoader),this.manager=void 0!==e?e:THREE.DefaultLoadingManager},THREE.SceneLoader.prototype={constructor:THREE.SceneLoader,load:function(e,r,a,t){var i=this,o=new THREE.FileLoader(i.manager);o.load(e,function(a){i.parse(JSON.parse(a),r,e)},a,t)},addGeometryHandler:function(e,r){this.geometryHandlers[e]={loaderClass:r}},addHierarchyHandler:function(e,r){this.hierarchyHandlers[e]={loaderClass:r}},parse:function(e,r,a){function t(e,r){return"relativeToHTML"==r?e:A+e}function i(){o(L.scene,j.objects)}function o(e,r){var a,i,n,s,l;for(var p in r){var d=L.objects[p],c=r[p];if(void 0===d){if(c.type&&c.type in S.hierarchyHandlers){if(void 0===c.loading){E=L.materials[c.material],c.loading=!0;var g=S.hierarchyHandlers[c.type].loaderObject;g.options?g.load(t(c.url,j.urlBaseType),m(p,e,E,c)):g.load(t(c.url,j.urlBaseType),m(p,e,E,c))}}else if(void 0!==c.geometry)f=L.geometries[c.geometry],f&&(E=L.materials[c.material],i=c.position,n=c.rotation,s=c.scale,a=c.matrix,l=c.quaternion,c.material||(E=new THREE.MultiMaterial(L.face_materials[c.geometry])),E instanceof THREE.MultiMaterial&&0===E.materials.length&&(E=new THREE.MultiMaterial(L.face_materials[c.geometry])),c.skin?d=new THREE.SkinnedMesh(f,E):c.morph?(d=new THREE.MorphAnimMesh(f,E),void 0!==c.duration&&(d.duration=c.duration),void 0!==c.time&&(d.time=c.time),void 0!==c.mirroredLoop&&(d.mirroredLoop=c.mirroredLoop),E.morphNormals&&f.computeMorphNormals()):d=new THREE.Mesh(f,E),d.name=p,a?(d.matrixAutoUpdate=!1,d.matrix.set(a[0],a[1],a[2],a[3],a[4],a[5],a[6],a[7],a[8],a[9],a[10],a[11],a[12],a[13],a[14],a[15])):(d.position.fromArray(i),l?d.quaternion.fromArray(l):d.rotation.fromArray(n),d.scale.fromArray(s)),d.visible=c.visible,d.castShadow=c.castShadow,d.receiveShadow=c.receiveShadow,e.add(d),L.objects[p]=d);else if("AmbientLight"===c.type||"PointLight"===c.type||"DirectionalLight"===c.type||"SpotLight"===c.type||"HemisphereLight"===c.type){var u=c.color,y=c.intensity,H=c.distance,T=c.position,R=c.rotation;switch(c.type){case"AmbientLight":v=new THREE.AmbientLight(u);break;case"PointLight":v=new THREE.PointLight(u,y,H),v.position.fromArray(T);break;case"DirectionalLight":v=new THREE.DirectionalLight(u,y),v.position.fromArray(c.direction);break;case"SpotLight":v=new THREE.SpotLight(u,y,H),v.angle=c.angle,v.position.fromArray(T),v.target.set(T[0],T[1]-H,T[2]),v.target.applyEuler(new THREE.Euler(R[0],R[1],R[2],"XYZ"));break;case"HemisphereLight":v=new THREE.DirectionalLight(u,y,H),v.target.set(T[0],T[1]-H,T[2]),v.target.applyEuler(new THREE.Euler(R[0],R[1],R[2],"XYZ"))}e.add(v),v.name=p,L.lights[p]=v,L.objects[p]=v}else"PerspectiveCamera"===c.type||"OrthographicCamera"===c.type?(i=c.position,n=c.rotation,l=c.quaternion,"PerspectiveCamera"===c.type?h=new THREE.PerspectiveCamera(c.fov,c.aspect,c.near,c.far):"OrthographicCamera"===c.type&&(h=new THREE.OrthographicCamera(c.left,c.right,c.top,c.bottom,c.near,c.far)),h.name=p,h.position.fromArray(i),void 0!==l?h.quaternion.fromArray(l):void 0!==n?h.rotation.fromArray(n):c.target&&h.lookAt((new THREE.Vector3).fromArray(c.target)),e.add(h),L.cameras[p]=h,L.objects[p]=h):(i=c.position,n=c.rotation,s=c.scale,l=c.quaternion,d=new THREE.Object3D,d.name=p,d.position.fromArray(i),l?d.quaternion.fromArray(l):d.rotation.fromArray(n),d.scale.fromArray(s),d.visible=void 0!==c.visible&&c.visible,e.add(d),L.objects[p]=d,L.empties[p]=d);if(d){if(void 0!==c.userData)for(var b in c.userData){var w=c.userData[b];d.userData[b]=w}if(void 0!==c.groups)for(var A=0;A<c.groups.length;A++){var M=c.groups[A];void 0===L.groups[M]&&(L.groups[M]=[]),L.groups[M].push(p)}}}void 0!==d&&void 0!==c.children&&o(d,c.children)}}function n(e,r,a){L.geometries[a]=e,L.face_materials[a]=r,i()}function s(e,r,a,t,o){var n=o.position,s=o.rotation,l=o.quaternion,m=o.scale;e.position.fromArray(n),l?e.quaternion.fromArray(l):e.rotation.fromArray(s),e.scale.fromArray(m),t&&e.traverse(function(e){e.material=t});var p=void 0===o.visible||o.visible;e.traverse(function(e){e.visible=p}),a.add(e),e.name=r,L.objects[r]=e,i()}function l(e){return function(r,a){r.name=e,n(r,a,e),T-=1,S.onLoadComplete(),d()}}function m(e,r,a,t){return function(i){var o;o=i.content?i.content:i.dae?i.scene:i,s(o,e,r,a,t),T-=1,S.onLoadComplete(),d()}}function p(e){return function(r,a){r.name=e,L.geometries[e]=r,L.face_materials[e]=a}}function d(){var e={totalModels:b,totalTextures:w,loadedModels:b-T,loadedTextures:w-R};S.callbackProgress(e,L),S.onLoadProgress(),0===T&&0===R&&(c(),r(L))}function c(){for(var e=0;e<M.length;e++){var r=M[e],a=L.objects[r.targetName];a?r.object.target=a:(r.object.target=new THREE.Object3D,L.scene.add(r.object.target)),r.object.target.userData.targetInverse=r.object}}function g(e,r){if(r(e),void 0!==e.children)for(var a in e.children)g(e.children[a],r)}var f,E,h,u,y,H,v,T,R,b,w,L,S=this,A=THREE.Loader.prototype.extractUrlBase(a),M=[],j=e;for(var x in this.geometryHandlers){var C=this.geometryHandlers[x].loaderClass;this.geometryHandlers[x].loaderObject=new C}for(var x in this.hierarchyHandlers){var C=this.hierarchyHandlers[x].loaderClass;this.hierarchyHandlers[x].loaderObject=new C}if(T=0,R=0,L={scene:new THREE.Scene,geometries:{},face_materials:{},materials:{},textures:{},objects:{},cameras:{},lights:{},fogs:{},empties:{},groups:{}},j.transform){var k=j.transform.position,D=j.transform.rotation,O=j.transform.scale;k&&L.scene.position.fromArray(k),D&&L.scene.rotation.fromArray(D),O&&L.scene.scale.fromArray(O),(k||D||O)&&(L.scene.updateMatrix(),L.scene.updateMatrixWorld())}var F,B,P=function(e){R-=e,d(),S.onLoadComplete()},G=function(e){return function(){P(e)}};for(F in j.fogs)B=j.fogs[F],"linear"===B.type?u=new THREE.Fog(0,B.near,B.far):"exp2"===B.type&&(u=new THREE.FogExp2(0,B.density)),H=B.color,u.color.setRGB(H[0],H[1],H[2]),L.fogs[F]=u;var q,N;for(q in j.geometries)N=j.geometries[q],N.type in this.geometryHandlers&&(T+=1,S.onLoadStart());for(var W in j.objects)g(j.objects[W],function(e){e.type&&e.type in S.hierarchyHandlers&&(T+=1,S.onLoadStart())});b=T;for(q in j.geometries)if(N=j.geometries[q],"cube"===N.type)f=new THREE.BoxGeometry(N.width,N.height,N.depth,N.widthSegments,N.heightSegments,N.depthSegments),f.name=q,L.geometries[q]=f;else if("plane"===N.type)f=new THREE.PlaneGeometry(N.width,N.height,N.widthSegments,N.heightSegments),f.name=q,L.geometries[q]=f;else if("sphere"===N.type)f=new THREE.SphereGeometry(N.radius,N.widthSegments,N.heightSegments),f.name=q,L.geometries[q]=f;else if("cylinder"===N.type)f=new THREE.CylinderGeometry(N.topRad,N.botRad,N.height,N.radSegs,N.heightSegs),f.name=q,L.geometries[q]=f;else if("torus"===N.type)f=new THREE.TorusGeometry(N.radius,N.tube,N.segmentsR,N.segmentsT),f.name=q,L.geometries[q]=f;else if("icosahedron"===N.type)f=new THREE.IcosahedronGeometry(N.radius,N.subdivisions),f.name=q,L.geometries[q]=f;else if(N.type in this.geometryHandlers){var _=this.geometryHandlers[N.type].loaderObject;_.load(t(N.url,j.urlBaseType),l(q))}else if("embedded"===N.type){var V=j.embeds[N.id],I="";if(V.metadata=j.metadata,V){var U=this.geometryHandlers.ascii.loaderObject,J=U.parse(V,I);p(q)(J.geometry,J.materials)}}var X,Y;for(X in j.textures)if(Y=j.textures[X],Array.isArray(Y.url)){R+=Y.url.length;for(var Z=0;Z<Y.url.length;Z++)S.onLoadStart()}else R+=1,S.onLoadStart();w=R;for(X in j.textures){Y=j.textures[X],void 0!==Y.mapping&&void 0!==THREE[Y.mapping]&&(Y.mapping=THREE[Y.mapping]);var y;if(Array.isArray(Y.url)){for(var z=Y.url.length,K=[],Q=0;Q<z;Q++)K[Q]=t(Y.url[Q],j.urlBaseType);var _=THREE.Loader.Handlers.get(K[0]);null!==_?(y=_.load(K,G(z)),void 0!==Y.mapping&&(y.mapping=Y.mapping)):(y=(new THREE.CubeTextureLoader).load(K,G(z)),y.mapping=Y.mapping)}else{var $=t(Y.url,j.urlBaseType),ee=G(1),_=THREE.Loader.Handlers.get($);if(null!==_?y=_.load($,ee):(y=new THREE.Texture,_=new THREE.ImageLoader,function(e){_.load($,function(r){e.image=r,e.needsUpdate=!0,ee()})}(y)),void 0!==Y.mapping&&(y.mapping=Y.mapping),void 0!==THREE[Y.minFilter]&&(y.minFilter=THREE[Y.minFilter]),void 0!==THREE[Y.magFilter]&&(y.magFilter=THREE[Y.magFilter]),Y.anisotropy&&(y.anisotropy=Y.anisotropy),Y.repeat&&(y.repeat.set(Y.repeat[0],Y.repeat[1]),1!==Y.repeat[0]&&(y.wrapS=THREE.RepeatWrapping),1!==Y.repeat[1]&&(y.wrapT=THREE.RepeatWrapping)),Y.offset&&y.offset.set(Y.offset[0],Y.offset[1]),Y.wrap){var re={repeat:THREE.RepeatWrapping,mirror:THREE.MirroredRepeatWrapping};void 0!==re[Y.wrap[0]]&&(y.wrapS=re[Y.wrap[0]]),void 0!==re[Y.wrap[1]]&&(y.wrapT=re[Y.wrap[1]])}}L.textures[X]=y}var ae,te,ie;for(ae in j.materials){te=j.materials[ae];for(ie in te.parameters)if("envMap"===ie||"map"===ie||"lightMap"===ie||"bumpMap"===ie||"normalMap"===ie||"alphaMap"===ie)te.parameters[ie]=L.textures[te.parameters[ie]];else if("shading"===ie)te.parameters[ie]="flat"===te.parameters[ie]?THREE.FlatShading:THREE.SmoothShading;else if("side"===ie)"double"==te.parameters[ie]?te.parameters[ie]=THREE.DoubleSide:"back"==te.parameters[ie]?te.parameters[ie]=THREE.BackSide:te.parameters[ie]=THREE.FrontSide;else if("blending"===ie)te.parameters[ie]=te.parameters[ie]in THREE?THREE[te.parameters[ie]]:THREE.NormalBlending;else if("combine"===ie)te.parameters[ie]=te.parameters[ie]in THREE?THREE[te.parameters[ie]]:THREE.MultiplyOperation;else if("vertexColors"===ie)"face"==te.parameters[ie]?te.parameters[ie]=THREE.FaceColors:te.parameters[ie]&&(te.parameters[ie]=THREE.VertexColors);else if("wrapRGB"===ie){var oe=te.parameters[ie];te.parameters[ie]=new THREE.Vector3(oe[0],oe[1],oe[2])}else if("normalScale"===ie){var ne=te.parameters[ie];te.parameters[ie]=new THREE.Vector2(ne[0],ne[1])}void 0!==te.parameters.opacity&&te.parameters.opacity<1&&(te.parameters.transparent=!0),E=new THREE[te.type](te.parameters),E.name=ae,L.materials[ae]=E}for(ae in j.materials)if(te=j.materials[ae],te.parameters.materials){for(var se=[],Q=0;Q<te.parameters.materials.length;Q++){var le=te.parameters.materials[Q];se.push(L.materials[le])}L.materials[ae].materials=se}i(),L.cameras&&j.defaults.camera&&(L.currentCamera=L.cameras[j.defaults.camera]),L.fogs&&j.defaults.fog&&(L.scene.fog=L.fogs[j.defaults.fog]),S.callbackSync(L),d()}};