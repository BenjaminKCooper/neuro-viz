function getHttpRequest(e,r,t){var o=new THREE.FileLoader;o.load(e,r,t)}function getJsonRequest(e,r){getHttpRequest(e,function(e){r(JSON.parse(e))},function(){})}function addListeners(e,r){for(var t in r)e.addEventListener(t,r[t])}THREE.UTF8Loader=function(){},THREE.UTF8Loader.prototype.load=function(e,r,t){this.downloadModelJson(e,r,t)},THREE.UTF8Loader.BufferGeometryCreator=function(){},THREE.UTF8Loader.BufferGeometryCreator.prototype.create=function(e,r){var t,o,a,n=r.length/3,d=new THREE.BufferGeometry,s=new Float32Array(3*n*3),c=new Float32Array(3*n*3),i=new Float32Array(3*n*2),f=e.length,h=8;for(o=0,a=0,t=a;t<f;t+=h)s[o++]=e[t],s[o++]=e[t+1],s[o++]=e[t+2];for(o=0,a=3,t=a;t<f;t+=h)i[o++]=e[t],i[o++]=e[t+1];for(o=0,a=5,t=a;t<f;t+=h)c[o++]=e[t],c[o++]=e[t+1],c[o++]=e[t+2];return d.setIndex(new THREE.BufferAttribute(r,1)),d.addAttribute("position",new THREE.BufferAttribute(s,3)),d.addAttribute("normal",new THREE.BufferAttribute(c,3)),d.addAttribute("uv",new THREE.BufferAttribute(i,2)),d.computeBoundingSphere(),d};var DEFAULT_DECODE_PARAMS={decodeOffsets:[-4095,-4095,-4095,0,0,-511,-511,-511],decodeScales:[1/8191,1/8191,1/8191,1/1023,1/1023,1/1023,1/1023,1/1023]};THREE.UTF8Loader.prototype.decompressAttribsInner_=function(e,r,t,o,a,n,d,s){for(var c=0,i=r;i<t;i++){var f=e.charCodeAt(i);c+=f>>1^-(1&f),o[a]=s*(c+d),a+=n}},THREE.UTF8Loader.prototype.decompressIndices_=function(e,r,t,o,a){for(var n=0,d=0;d<t;d++){var s=e.charCodeAt(r++);o[a++]=n-s,0===s&&n++}},THREE.UTF8Loader.prototype.decompressAABBs_=function(e,r,t,o,a){for(var n=6*t,d=r+n,s=0,c=new Float32Array(n),i=r;i<d;i+=6){var f=e.charCodeAt(i+0)+o[0],h=e.charCodeAt(i+1)+o[1],E=e.charCodeAt(i+2)+o[2],l=e.charCodeAt(i+3)+1>>1,u=e.charCodeAt(i+4)+1>>1,A=e.charCodeAt(i+5)+1>>1;c[s++]=a[0]*(f+l),c[s++]=a[1]*(h+u),c[s++]=a[2]*(E+A),c[s++]=a[0]*l,c[s++]=a[1]*u,c[s++]=a[2]*A}return c},THREE.UTF8Loader.prototype.decompressMesh=function(e,r,t,o,a,n){for(var d=t.decodeScales.length,s=t.decodeOffsets,c=t.decodeScales,i=r.attribRange[0],f=r.attribRange[1],h=i,E=new Float32Array(d*f),l=0;l<d;l++){var u=h+f,A=c[l];A&&this.decompressAttribsInner_(e,h,u,E,l,d,s[l],A),h=u}var p=(r.indexRange[0],3*r.indexRange[1]),T=new Uint16Array(p);this.decompressIndices_(e,h,p,T,0);var v=void 0,R=r.bboxes;R&&(v=this.decompressAABBs_(e,R,r.names.length,s,c)),n(o,a,E,T,v,r)},THREE.UTF8Loader.prototype.copyAttrib=function(e,r,t,o){for(var a=0;a<e;a++)t[a]=r[e*o+a]},THREE.UTF8Loader.prototype.decodeAttrib2=function(e,r,t,o,a,n,d,s,c,i){for(var f=0;f<5;f++){var h=e.charCodeAt(a+n*f+i),E=h>>1^-(1&h);c[f]+=E,s[r*i+f]=c[f],d[r*i+f]=o[f]*(c[f]+t[f])}},THREE.UTF8Loader.prototype.accumulateNormal=function(e,r,t,o,a){var n=o[8*e],d=o[8*e+1],s=o[8*e+2],c=o[8*r],i=o[8*r+1],f=o[8*r+2],h=o[8*t],E=o[8*t+1],l=o[8*t+2];c-=n,i-=d,f-=s,h-=n,E-=d,l-=s,n=i*l-f*E,d=f*h-c*l,s=c*E-i*h,a[3*e]+=n,a[3*e+1]+=d,a[3*e+2]+=s,a[3*r]+=n,a[3*r+1]+=d,a[3*r+2]+=s,a[3*t]+=n,a[3*t+1]+=d,a[3*t+2]+=s},THREE.UTF8Loader.prototype.decompressMesh2=function(e,r,t,o,a,n){for(var d=96,s=t.decodeScales.length,c=t.decodeOffsets,i=t.decodeScales,f=r.attribRange[0],h=r.attribRange[1],E=r.codeRange[0],l=(r.codeRange[1],3*r.codeRange[2]),u=new Uint16Array(l),A=new Int32Array(3*h),p=new Uint16Array(s),T=new Uint16Array(s*h),v=new Float32Array(s*h),R=0,y=0,m=0;m<l;m+=3){var b=e.charCodeAt(E++),w=Math.min(m,d);if(b<w){var H,g,F,C=b%3,L=m-(b-C);switch(C){case 0:H=u[L+2],g=u[L+1],F=u[L+0];break;case 1:H=u[L+0],g=u[L+2],F=u[L+1];break;case 2:H=u[L+1],g=u[L+0],F=u[L+2]}u[y++]=H,u[y++]=g,b=e.charCodeAt(E++);var U=R-b;if(u[y++]=U,0===b){for(var M=0;M<5;M++){var B=e.charCodeAt(f+h*M+R),_=(B>>1^-(1&B))+T[s*H+M]+T[s*g+M]-T[s*F+M];p[M]=_,T[s*R+M]=_,v[s*R+M]=i[M]*(_+c[M])}R++}else this.copyAttrib(s,T,p,U);this.accumulateNormal(H,g,U,T,A)}else{var O=R-(b-w);u[y++]=O,b===w?this.decodeAttrib2(e,s,c,i,f,h,v,T,p,R++):this.copyAttrib(s,T,p,O),b=e.charCodeAt(E++);var S=R-b;u[y++]=S,0===b?this.decodeAttrib2(e,s,c,i,f,h,v,T,p,R++):this.copyAttrib(s,T,p,S),b=e.charCodeAt(E++);var D=R-b;if(u[y++]=D,0===b){for(var M=0;M<5;M++)p[M]=(T[s*O+M]+T[s*S+M])/2;this.decodeAttrib2(e,s,c,i,f,h,v,T,p,R++)}else this.copyAttrib(s,T,p,D);this.accumulateNormal(O,S,D,T,A)}}for(var m=0;m<h;m++){var P=A[3*m],I=A[3*m+1],k=A[3*m+2],q=511/Math.sqrt(P*P+I*I+k*k),x=e.charCodeAt(f+5*h+m),J=e.charCodeAt(f+6*h+m),G=e.charCodeAt(f+7*h+m);v[s*m+5]=q*P+(x>>1^-(1&x)),v[s*m+6]=q*I+(J>>1^-(1&J)),v[s*m+7]=q*k+(G>>1^-(1&G))}n(o,a,v,u,void 0,r)},THREE.UTF8Loader.prototype.downloadMesh=function(e,r,t,o,a){function n(e){for(;s<t.length;){var n=t[s],c=n.indexRange;if(c){var i=c[0]+3*c[1];if(e.length<i)break;d.decompressMesh(e,n,o,r,s,a)}else{var f=n.codeRange,i=f[0]+f[1];if(e.length<i)break;d.decompressMesh2(e,n,o,r,s,a)}++s}}var d=this,s=0;getHttpRequest(e,function(e){n(e)})},THREE.UTF8Loader.prototype.downloadMeshes=function(e,r,t,o){for(var a in r){var n=r[a];this.downloadMesh(e+a,a,n,t,o)}},THREE.UTF8Loader.prototype.createMeshCallback=function(e,r,t){var o=0,a=0,n={},d={},s={},c=r.urls;for(var i in c)n[i]=c[i].length,d[i]=0,a++,s[i]=new THREE.Object3D;var f=new THREE.Object3D,h=new THREE.MTLLoader.MaterialCreator(e,r.options);h.setMaterials(r.materials),h.preload();var E=new THREE.UTF8Loader.BufferGeometryCreator,l=function(e,r,c,i,l,u){var A=E.create(c,i),p=h.create(u.material),T=new THREE.Mesh(A,p);s[e].add(T),d[e]++,d[e]===n[e]&&(o++,f.add(s[e]),o===a&&t(f))};return l},THREE.UTF8Loader.prototype.downloadModel=function(e,r,t,o){var a=this.createMeshCallback(r,t,o);this.downloadMeshes(e,t.urls,t.decodeParams,a)},THREE.UTF8Loader.prototype.downloadModelJson=function(e,r,t){getJsonRequest(e,function(o){o.decodeParams||(t&&t.decodeParams?o.decodeParams=t.decodeParams:o.decodeParams=DEFAULT_DECODE_PARAMS),o.options=t;var a=e.substr(0,e.lastIndexOf("/")+1),n=a;t&&t.geometryBase&&(a=t.geometryBase,"/"!==a.charAt(a.length-1)&&(a+="/")),t&&t.materialBase&&(n=t.materialBase,"/"!==n.charAt(n.length-1)&&(n+="/")),this.downloadModel(a,n,o,r)}.bind(this))};