THREE.RaytracingRenderer=function(e){function t(e){e.postMessage({init:[a,i],worker:e.id,blockSize:g})}function r(e){if(!m.length)return h=!1,c.dispatchEvent({type:"complete"});var t=m.pop(),r=t%k*g,o=(t/k|0)*g;e.postMessage({render:!0,x:r,y:o,sceneId:v}),d.fillStyle="#"+e.color,d.fillRect(r,o,g,g)}function o(e){var t=e.material;if(t&&!(t.uuid in z)){var r={};for(var o in b)void 0!==t[o]&&(r[o]=t[o]);z[t.uuid]=r}}console.log("THREE.RaytracingRenderer",THREE.REVISION),e=e||{};var a,i,n,s,c=this,l=[],h=!1,f=document.createElement("canvas"),d=f.getContext("2d",{alpha:e.alpha===!0}),p=new THREE.Color(0);this.domElement=f,this.autoClear=!0;var u=e.workers,g=e.blockSize||64;this.randomize=e.randomize;var m=[],E=0,v=0;console.log("%cSpinning off "+u+" Workers ","font-size: 20px; background: black; color: white; font-family: monospace;"),this.setWorkers=function(o){for(u=o||navigator.hardwareConcurrency||4;l.length<u;){var a=new Worker(e.workerPath);a.id=E++,a.onmessage=function(e){var t=e.data;if(t&&t.blockSize&&v==t.sceneId){var o=new ImageData(new Uint8ClampedArray(t.data),t.blockSize,t.blockSize);if(d.putImageData(o,t.blockX,t.blockY),console.log("Worker "+this.id,t.time/1e3,(Date.now()-M)/1e3+" s"),l.length>u)return l.splice(l.indexOf(this),1),this.terminate();r(this)}},a.color=(new THREE.Color).setHSL(Math.random(),.8,.8).getHexString(),l.push(a),h&&(t(a),a.postMessage({scene:S,camera:y,annex:z,sceneId:v}),r(a))}if(!h)for(;l.length>u;)l.pop().terminate()},this.setWorkers(u),this.setClearColor=function(e,t){p.set(e)},this.setPixelRatio=function(){},this.setSize=function(e,r){f.width=e,f.height=r,a=f.width,i=f.height,n=Math.floor(a/2),s=Math.floor(i/2),d.fillStyle="white",l.forEach(t)},this.setSize(f.width,f.height),this.clear=function(){};var R,k,w,S,y,M,z={},b={mirror:1,reflectivity:1,refractionRatio:1,glass:1};this.render=function(e,t){h=!0,e.autoUpdate===!0&&e.updateMatrixWorld(),null===t.parent&&t.updateMatrixWorld(),S=e.toJSON(),y=t.toJSON(),++v,e.traverse(o),l.forEach(function(e){e.postMessage({scene:S,camera:y,annex:z,sceneId:v})}),d.clearRect(0,0,a,i),M=Date.now(),k=Math.ceil(a/g),w=Math.ceil(i/g),R=k*w,m=[];for(var n=0;n<R;n++)m.push(n);if(c.randomize)for(var n=0;n<R;n++){var s=Math.random()*R|0,f=m[s];m[s]=m[n],m[n]=f}l.forEach(r)}},Object.assign(THREE.RaytracingRenderer.prototype,THREE.EventDispatcher.prototype);