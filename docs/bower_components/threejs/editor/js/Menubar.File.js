Menubar.File=function(e){function t(e,t){i.href=URL.createObjectURL(e),i.download=t||"data.json",i.click()}function n(e,n){t(new Blob([e],{type:"text/plain"}),n)}var o=new UI.Panel;o.setClass("menu");var s=new UI.Panel;s.setClass("title"),s.setTextContent("File"),o.add(s);var l=new UI.Panel;l.setClass("options"),o.add(l);var a=new UI.Row;a.setClass("option"),a.setTextContent("New"),a.onClick(function(){confirm("Any unsaved data will be lost. Are you sure?")&&e.clear()}),l.add(a),l.add(new UI.HorizontalRule);var r=document.createElement("input");r.type="file",r.addEventListener("change",function(t){e.loader.loadFile(r.files[0])});var a=new UI.Row;a.setClass("option"),a.setTextContent("Import"),a.onClick(function(){r.click()}),l.add(a),l.add(new UI.HorizontalRule);var a=new UI.Row;a.setClass("option"),a.setTextContent("Export Geometry"),a.onClick(function(){var t=e.selected;if(null===t)return void alert("No object selected.");var o=t.geometry;if(void 0===o)return void alert("The selected object doesn't have geometry.");var s=o.toJSON();try{s=JSON.stringify(s,null,"\t"),s=s.replace(/[\n\t]+([\d\.e\-\[\]]+)/g,"$1")}catch(e){s=JSON.stringify(s)}n(s,"geometry.json")}),l.add(a);var a=new UI.Row;a.setClass("option"),a.setTextContent("Export Object"),a.onClick(function(){var t=e.selected;if(null===t)return void alert("No object selected");var o=t.toJSON();try{o=JSON.stringify(o,null,"\t"),o=o.replace(/[\n\t]+([\d\.e\-\[\]]+)/g,"$1")}catch(e){o=JSON.stringify(o)}n(o,"model.json")}),l.add(a);var a=new UI.Row;a.setClass("option"),a.setTextContent("Export Scene"),a.onClick(function(){var t=e.scene.toJSON();try{t=JSON.stringify(t,null,"\t"),t=t.replace(/[\n\t]+([\d\.e\-\[\]]+)/g,"$1")}catch(e){t=JSON.stringify(t)}n(t,"scene.json")}),l.add(a);var a=new UI.Row;a.setClass("option"),a.setTextContent("Export OBJ"),a.onClick(function(){var t=e.selected;if(null===t)return void alert("No object selected.");var o=new THREE.OBJExporter;n(o.parse(t),"model.obj")}),l.add(a);var a=new UI.Row;a.setClass("option"),a.setTextContent("Export STL"),a.onClick(function(){var t=new THREE.STLExporter;n(t.parse(e.scene),"model.stl")}),l.add(a),l.add(new UI.HorizontalRule);var a=new UI.Row;a.setClass("option"),a.setTextContent("Publish"),a.onClick(function(){var n=new JSZip,o=e.toJSON();o.metadata.type="App",delete o.history;var s=o.project.vr;o=JSON.stringify(o,null,"\t"),o=o.replace(/[\n\t]+([\d\.e\-\[\]]+)/g,"$1"),n.file("app.json",o);var l=new THREE.LoadingManager(function(){t(n.generate({type:"blob"}),"download.zip")}),a=new THREE.FileLoader(l);a.load("js/libs/app/index.html",function(e){var t=[];s&&(t.push('<script src="js/VRControls.js"></script>'),t.push('<script src="js/VREffect.js"></script>'),t.push('<script src="js/WebVR.js"></script>')),e=e.replace("<!-- includes -->",t.join("\n\t\t")),n.file("index.html",e)}),a.load("js/libs/app.js",function(e){n.file("js/app.js",e)}),a.load("../build/three.min.js",function(e){n.file("js/three.min.js",e)}),s&&(a.load("../examples/js/controls/VRControls.js",function(e){n.file("js/VRControls.js",e)}),a.load("../examples/js/effects/VREffect.js",function(e){n.file("js/VREffect.js",e)}),a.load("../examples/js/WebVR.js",function(e){n.file("js/WebVR.js",e)}))}),l.add(a);var i=document.createElement("a");return i.style.display="none",document.body.appendChild(i),o};