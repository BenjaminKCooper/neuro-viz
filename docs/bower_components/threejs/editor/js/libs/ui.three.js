UI.Texture=function(e){function t(t){if(t.type.match("image.*")){var i=new FileReader;"image/targa"===t.type?(i.addEventListener("load",function(i){var a=(new THREE.TGALoader).parse(i.target.result),o=new THREE.CanvasTexture(a,e);o.sourceFile=t.name,n.setValue(o),n.onChangeCallback&&n.onChangeCallback()},!1),i.readAsArrayBuffer(t)):(i.addEventListener("load",function(i){var a=document.createElement("img");a.addEventListener("load",function(i){var a=new THREE.Texture(this,e);a.sourceFile=t.name,a.needsUpdate=!0,n.setValue(a),n.onChangeCallback&&n.onChangeCallback()},!1),a.src=i.target.result},!1),i.readAsDataURL(t))}a.reset()}UI.Element.call(this);var n=this,i=document.createElement("span"),a=document.createElement("form"),o=document.createElement("input");o.type="file",o.addEventListener("change",function(e){t(e.target.files[0])}),a.appendChild(o);var s=document.createElement("canvas");s.width=32,s.height=16,s.style.cursor="pointer",s.style.marginRight="5px",s.style.border="1px solid #888",s.addEventListener("click",function(e){o.click()},!1),s.addEventListener("drop",function(e){e.preventDefault(),e.stopPropagation(),t(e.dataTransfer.files[0])},!1),i.appendChild(s);var r=document.createElement("input");return r.disabled=!0,r.style.width="64px",r.style.border="1px solid #ccc",i.appendChild(r),this.dom=i,this.texture=null,this.onChangeCallback=null,this},UI.Texture.prototype=Object.create(UI.Element.prototype),UI.Texture.prototype.constructor=UI.Texture,UI.Texture.prototype.getValue=function(){return this.texture},UI.Texture.prototype.setValue=function(e){var t=this.dom.children[0],n=this.dom.children[1],i=t.getContext("2d");if(null!==e){var a=e.image;if(void 0!==a&&a.width>0){n.value=e.sourceFile;var o=t.width/a.width;i.drawImage(a,0,0,a.width*o,a.height*o)}else n.value=e.sourceFile+" (error)",i.clearRect(0,0,t.width,t.height)}else n.value="",null!==i&&i.clearRect(0,0,t.width,t.height);this.texture=e},UI.Texture.prototype.onChange=function(e){return this.onChangeCallback=e,this},UI.Outliner=function(e){UI.Element.call(this);var t=this,n=document.createElement("div");return n.className="Outliner",n.tabIndex=0,this.scene=e.scene,n.addEventListener("keydown",function(e){switch(e.keyCode){case 38:case 40:e.preventDefault(),e.stopPropagation()}},!1),n.addEventListener("keyup",function(e){switch(e.keyCode){case 38:t.selectIndex(t.selectedIndex-1);break;case 40:t.selectIndex(t.selectedIndex+1)}},!1),this.dom=n,this.options=[],this.selectedIndex=-1,this.selectedValue=null,this},UI.Outliner.prototype=Object.create(UI.Element.prototype),UI.Outliner.prototype.constructor=UI.Outliner,UI.Outliner.prototype.selectIndex=function(e){if(e>=0&&e<this.options.length){this.setValue(this.options[e].value);var t=document.createEvent("HTMLEvents");t.initEvent("change",!0,!0),this.dom.dispatchEvent(t)}},UI.Outliner.prototype.setOptions=function(e){function t(){l.setValue(this.value);var e=document.createEvent("HTMLEvents");e.initEvent("change",!0,!0),l.dom.dispatchEvent(e)}function n(e){c=this}function i(e){e.dataTransfer.setData("text","foo")}function a(e){if(this!==c){var t=e.offsetY/this.clientHeight;t<.25?this.className="option dragTop":t>.75?this.className="option dragBottom":this.className="option drag"}}function o(){this!==c&&(this.className="option")}function s(e){if(this!==c){this.className="option";var t=l.scene,n=t.getObjectById(c.value),i=e.offsetY/this.clientHeight;if(i<.25){var a=t.getObjectById(this.value);r(n,a.parent,a)}else if(i>.75){var a=t.getObjectById(this.nextSibling.value);r(n,a.parent,a)}else{var o=t.getObjectById(this.value);r(n,o)}}}function r(e,t,n){null===n&&(n=void 0);var i=!1;if(e.traverse(function(e){e===t&&(i=!0)}),!i){editor.execute(new MoveObjectCommand(e,t,n));var a=document.createEvent("HTMLEvents");a.initEvent("change",!0,!0),l.dom.dispatchEvent(a)}}for(var l=this;l.dom.children.length>0;)l.dom.removeChild(l.dom.firstChild);var c;l.options=[];for(var d=0;d<e.length;d++){var h=e[d];h.className="option",l.dom.appendChild(h),l.options.push(h),h.addEventListener("click",t,!1),h.draggable===!0&&(h.addEventListener("drag",n,!1),h.addEventListener("dragstart",i,!1),h.addEventListener("dragover",a,!1),h.addEventListener("dragleave",o,!1),h.addEventListener("drop",s,!1))}return l},UI.Outliner.prototype.getValue=function(){return this.selectedValue},UI.Outliner.prototype.setValue=function(e){for(var t=0;t<this.options.length;t++){var n=this.options[t];if(n.value===e){n.classList.add("active");var i=n.offsetTop-this.dom.offsetTop,a=i+n.offsetHeight,o=a-this.dom.offsetHeight;this.dom.scrollTop>i?this.dom.scrollTop=i:this.dom.scrollTop<o&&(this.dom.scrollTop=o),this.selectedIndex=t}else n.classList.remove("active")}return this.selectedValue=e,this},UI.THREE={},UI.THREE.Boolean=function(e,t){UI.Span.call(this),this.setMarginRight("10px"),this.checkbox=new UI.Checkbox(e),this.text=new UI.Text(t).setMarginLeft("3px"),this.add(this.checkbox),this.add(this.text)},UI.THREE.Boolean.prototype=Object.create(UI.Span.prototype),UI.THREE.Boolean.prototype.constructor=UI.THREE.Boolean,UI.THREE.Boolean.prototype.getValue=function(){return this.checkbox.getValue()},UI.THREE.Boolean.prototype.setValue=function(e){return this.checkbox.setValue(e)};