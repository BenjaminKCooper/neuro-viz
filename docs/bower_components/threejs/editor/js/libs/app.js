var APP={Player:function(){function e(e,t){for(var n=0,o=e.length;n<o;n++)e[n](t)}function t(n){g=requestAnimationFrame(t);try{e(w.update,{time:n,delta:n-L})}catch(e){console.error(e.message||e,e.stack||"")}E===!0?(c.updateMatrixWorld(),v.update(),p.render(m,l)):h.render(m,c),L=n}function n(t){e(w.keydown,t)}function o(t){e(w.keyup,t)}function i(t){e(w.mousedown,t)}function r(t){e(w.mouseup,t)}function s(t){e(w.mousemove,t)}function a(t){e(w.touchstart,t)}function d(t){e(w.touchend,t)}function u(t){e(w.touchmove,t)}var c,m,h,v,p,l,E,f=new THREE.ObjectLoader,w={};this.dom=document.createElement("div"),this.width=500,this.height=500,this.load=function(t){E=t.project.vr,h=new THREE.WebGLRenderer({antialias:!0}),h.setClearColor(0),h.setPixelRatio(window.devicePixelRatio),t.project.gammaInput&&(h.gammaInput=!0),t.project.gammaOutput&&(h.gammaOutput=!0),t.project.shadows&&(h.shadowMap.enabled=!0),this.dom.appendChild(h.domElement),this.setScene(f.parse(t.scene)),this.setCamera(f.parse(t.camera)),w={init:[],start:[],stop:[],keydown:[],keyup:[],mousedown:[],mouseup:[],mousemove:[],touchstart:[],touchend:[],touchmove:[],update:[]};var n="player,renderer,scene,camera",o={};for(var i in w)n+=","+i,o[i]=i;var r=JSON.stringify(o).replace(/\"/g,"");for(var s in t.scripts){var a=m.getObjectByProperty("uuid",s,!0);if(void 0!==a)for(var d=t.scripts[s],u=0;u<d.length;u++){var v=d[u],p=new Function(n,v.source+"\nreturn "+r+";").bind(a)(this,h,m,c);for(var l in p)void 0!==p[l]&&(void 0!==w[l]?w[l].push(p[l].bind(a)):console.warn("APP.Player: Event type not supported (",l,")"))}else console.warn("APP.Player: Script without object.",s)}e(w.init,arguments)},this.setCamera=function(e){c=e,c.aspect=this.width/this.height,c.updateProjectionMatrix(),E===!0&&(l=new THREE.PerspectiveCamera,l.projectionMatrix=c.projectionMatrix,c.add(l),v=new THREE.VRControls(l),p=new THREE.VREffect(h),WEBVR.isAvailable()===!0&&this.dom.appendChild(WEBVR.getButton(p)),WEBVR.isLatestAvailable()===!1&&this.dom.appendChild(WEBVR.getMessage()))},this.setScene=function(e){m=e},this.setSize=function(e,t){this.width=e,this.height=t,c&&(c.aspect=this.width/this.height,c.updateProjectionMatrix()),h&&h.setSize(e,t)};var L,g;this.play=function(){document.addEventListener("keydown",n),document.addEventListener("keyup",o),document.addEventListener("mousedown",i),document.addEventListener("mouseup",r),document.addEventListener("mousemove",s),document.addEventListener("touchstart",a),document.addEventListener("touchend",d),document.addEventListener("touchmove",u),e(w.start,arguments),g=requestAnimationFrame(t),L=performance.now()},this.stop=function(){document.removeEventListener("keydown",n),document.removeEventListener("keyup",o),document.removeEventListener("mousedown",i),document.removeEventListener("mouseup",r),document.removeEventListener("mousemove",s),document.removeEventListener("touchstart",a),document.removeEventListener("touchend",d),document.removeEventListener("touchmove",u),e(w.stop,arguments),cancelAnimationFrame(g)},this.dispose=function(){for(;this.dom.children.length;)this.dom.removeChild(this.dom.firstChild);h.dispose(),c=void 0,m=void 0,h=void 0}}};