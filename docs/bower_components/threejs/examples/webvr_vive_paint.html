<!DOCTYPE html><html lang="en"><head>
		<title>three.js webvr - htc vive - paint</title>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no">
		<style>
			body {
				font-family: Monospace;
				background-color: #101010;
				color: #fff;
				margin: 0px;
				overflow: hidden;
			}
			a {
				color: #f00;
			}
		</style>
	</head>
	<body>

		<script src="../build/three.js"></script>

		<script src="js/controls/VRControls.js"></script>
		<script src="js/effects/VREffect.js"></script>
		<script src="js/vr/ViveController.js"></script>
		<script src="js/vr/PaintViveController.js"></script>
		<script src="js/vr/WebVR.js"></script>

		<script src="js/loaders/OBJLoader.js"></script>

		<script>function init(){container=document.createElement("div"),document.body.appendChild(container);var e=document.createElement("div");e.style.position="absolute",e.style.top="10px",e.style.width="100%",e.style.textAlign="center",e.innerHTML='<a href="http://threejs.org" target="_blank">three.js</a> webgl - htc vive - paint',container.appendChild(e),scene=new THREE.Scene,scene.background=new THREE.Color(2236962),camera=new THREE.PerspectiveCamera(70,window.innerWidth/window.innerHeight,.01,50),scene.add(camera);var r=new THREE.BoxGeometry(.5,.8,.5),t=new THREE.MeshStandardMaterial({color:4473924,roughness:1,metalness:0}),o=new THREE.Mesh(r,t);o.position.y=.35,o.position.z=.85,o.castShadow=!0,o.receiveShadow=!0,scene.add(o);var r=new THREE.PlaneGeometry(4,4),t=new THREE.MeshStandardMaterial({color:2236962,roughness:1,metalness:0}),a=new THREE.Mesh(r,t);a.rotation.x=-Math.PI/2,a.receiveShadow=!0,scene.add(a),scene.add(new THREE.GridHelper(10,40,1118481,1118481)),scene.add(new THREE.HemisphereLight(8947831,7829384));var n=new THREE.DirectionalLight(16777215);n.position.set(0,6,0),n.castShadow=!0,n.shadow.camera.top=2,n.shadow.camera.bottom=-2,n.shadow.camera.right=2,n.shadow.camera.left=-2,n.shadow.mapSize.set(4096,4096),scene.add(n),renderer=new THREE.WebGLRenderer({antialias:!0}),renderer.setPixelRatio(window.devicePixelRatio),renderer.setSize(window.innerWidth,window.innerHeight),renderer.sortObjects=!1,renderer.shadowMap.enabled=!0,renderer.gammaInput=!0,renderer.gammaOutput=!0,container.appendChild(renderer.domElement),controls=new THREE.VRControls(camera),controls.standing=!0,controller1=new THREE.PaintViveController(0),controller1.standingMatrix=controls.getStandingMatrix(),controller1.userData.points=[new THREE.Vector3,new THREE.Vector3],controller1.userData.matrices=[new THREE.Matrix4,new THREE.Matrix4],scene.add(controller1),controller2=new THREE.PaintViveController(1),controller2.standingMatrix=controls.getStandingMatrix(),controller2.userData.points=[new THREE.Vector3,new THREE.Vector3],controller2.userData.matrices=[new THREE.Matrix4,new THREE.Matrix4],scene.add(controller2);var i=new THREE.OBJLoader;i.setPath("models/obj/vive-controller/"),i.load("vr_controller_vive_1_5.obj",function(e){var r=new THREE.TextureLoader;r.setPath("models/obj/vive-controller/");var t=e.children[0];t.material.map=r.load("onepointfive_texture.png"),t.material.specularMap=r.load("onepointfive_spec.png"),t.castShadow=!0,t.receiveShadow=!0;var o=new THREE.Mesh(new THREE.IcosahedronGeometry(.002,2));o.name="pivot",o.position.y=-.016,o.position.z=-.043,o.rotation.x=Math.PI/5.5,t.add(o),controller1.add(t.clone()),o.material=o.material.clone(),controller2.add(t.clone())}),effect=new THREE.VREffect(renderer),WEBVR.isAvailable()===!0&&document.body.appendChild(WEBVR.getButton(effect)),window.addEventListener("resize",onWindowResize,!1)}function initGeometry(){var e=new THREE.BufferGeometry,r=new THREE.BufferAttribute(new Float32Array(3e6),3);r.dynamic=!0,e.addAttribute("position",r);var t=new THREE.BufferAttribute(new Float32Array(3e6),3);t.dynamic=!0,e.addAttribute("normal",t);var o=new THREE.BufferAttribute(new Float32Array(3e6),3);o.dynamic=!0,e.addAttribute("color",o),e.drawRange.count=0;var a=new THREE.MeshStandardMaterial({roughness:.9,metalness:0,vertexColors:THREE.VertexColors,side:THREE.DoubleSide});line=new THREE.Mesh(e,a),line.frustumCulled=!1,line.castShadow=!0,line.receiveShadow=!0,scene.add(line);for(var n=2*Math.PI,i=10,c=[],d=0;d<i;d++){var l=d/i*n;c.push(new THREE.Vector3(.01*Math.sin(l),.01*Math.cos(l),0))}shapes.tube=c}function stroke(e,r,t,o,a){for(var n=e.getColor(),i=shapes.tube,c=line.geometry,d=c.attributes,l=c.drawRange.count,s=d.position.array,E=d.normal.array,p=d.color.array,w=0,v=i.length;w<v;w++){var m=i[w],u=i[(w+1)%v];vector1.copy(m),vector1.applyMatrix4(a),vector1.add(t),vector2.copy(u),vector2.applyMatrix4(a),vector2.add(t),vector3.copy(u),vector3.applyMatrix4(o),vector3.add(r),vector4.copy(m),vector4.applyMatrix4(o),vector4.add(r),vector1.toArray(s,3*(l+0)),vector2.toArray(s,3*(l+1)),vector4.toArray(s,3*(l+2)),vector2.toArray(s,3*(l+3)),vector3.toArray(s,3*(l+4)),vector4.toArray(s,3*(l+5)),vector1.copy(m),vector1.applyMatrix4(a),vector1.normalize(),vector2.copy(u),vector2.applyMatrix4(a),vector2.normalize(),vector3.copy(u),vector3.applyMatrix4(o),vector3.normalize(),vector4.copy(m),vector4.applyMatrix4(o),vector4.normalize(),vector1.toArray(E,3*(l+0)),vector2.toArray(E,3*(l+1)),vector4.toArray(E,3*(l+2)),vector2.toArray(E,3*(l+3)),vector3.toArray(E,3*(l+4)),vector4.toArray(E,3*(l+5)),n.toArray(p,3*(l+0)),n.toArray(p,3*(l+1)),n.toArray(p,3*(l+2)),n.toArray(p,3*(l+3)),n.toArray(p,3*(l+4)),n.toArray(p,3*(l+5)),l+=6}c.drawRange.count=l}function updateGeometry(e,r){if(e!==r){var t=3*e,o=3*(r-e),a=line.geometry,n=a.attributes;n.position.updateRange.offset=t,n.position.updateRange.count=o,n.position.needsUpdate=!0,n.normal.updateRange.offset=t,n.normal.updateRange.count=o,n.normal.needsUpdate=!0,n.color.updateRange.offset=t,n.color.updateRange.count=o,n.color.needsUpdate=!0}}function onWindowResize(){camera.aspect=window.innerWidth/window.innerHeight,camera.updateProjectionMatrix(),effect.setSize(window.innerWidth,window.innerHeight)}function animate(){effect.requestAnimationFrame(animate),render()}function handleController(e){e.update();var r=e.getObjectByName("pivot");if(r){r.material.color.copy(e.getColor());var t=r.matrixWorld,o=e.userData.points[0],a=e.userData.points[1],n=e.userData.matrices[0],i=e.userData.matrices[1];o.setFromMatrixPosition(t),n.lookAt(a,o,up),e.getButtonState("trigger")&&stroke(e,o,a,n,i),a.copy(o),i.copy(n)}}function render(){controls.update();var e=line.geometry.drawRange.count;handleController(controller1),handleController(controller2),updateGeometry(e,line.geometry.drawRange.count),effect.render(scene,camera)}WEBVR.isAvailable()===!1&&document.body.appendChild(WEBVR.getMessage());var container,camera,scene,renderer,effect,controls,controller1,controller2,line,shapes={},up=new THREE.Vector3(0,1,0),vector=new THREE.Vector3,vector1=new THREE.Vector3,vector2=new THREE.Vector3,vector3=new THREE.Vector3,vector4=new THREE.Vector3,point4=new THREE.Vector3,point5=new THREE.Vector3;init(),initGeometry(),animate();</script>
	

</body></html>