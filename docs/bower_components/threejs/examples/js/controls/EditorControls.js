THREE.EditorControls=function(e,t){function o(e){E.enabled!==!1&&(0===e.button?d=u.ROTATE:1===e.button?d=u.ZOOM:2===e.button&&(d=u.PAN),m.set(e.clientX,e.clientY),t.addEventListener("mousemove",n,!1),t.addEventListener("mouseup",s,!1),t.addEventListener("mouseout",s,!1),t.addEventListener("dblclick",s,!1))}function n(e){if(E.enabled!==!1){h.set(e.clientX,e.clientY);var t=h.x-m.x,o=h.y-m.y;d===u.ROTATE?E.rotate(new THREE.Vector3(-t*E.rotationSpeed,-o*E.rotationSpeed,0)):d===u.ZOOM?E.zoom(new THREE.Vector3(0,0,o)):d===u.PAN&&E.pan(new THREE.Vector3(-t,o,0)),m.set(e.clientX,e.clientY)}}function s(e){t.removeEventListener("mousemove",n,!1),t.removeEventListener("mouseup",s,!1),t.removeEventListener("mouseout",s,!1),t.removeEventListener("dblclick",s,!1),d=u.NONE}function r(e){e.preventDefault(),E.zoom(new THREE.Vector3(0,0,e.deltaY))}function i(e){e.preventDefault()}function c(e){if(E.enabled!==!1){switch(e.touches.length){case 1:w[0].set(e.touches[0].pageX,e.touches[0].pageY,0),w[1].set(e.touches[0].pageX,e.touches[0].pageY,0);break;case 2:w[0].set(e.touches[0].pageX,e.touches[0].pageY,0),w[1].set(e.touches[1].pageX,e.touches[1].pageY,0),H=w[0].distanceTo(w[1])}g[0].copy(w[0]),g[1].copy(w[1])}}function a(e){function t(e,t){var o=t[0];for(var n in t)o.distanceTo(e)>t[n].distanceTo(e)&&(o=t[n]);return o}if(E.enabled!==!1){switch(e.preventDefault(),e.stopPropagation(),e.touches.length){case 1:w[0].set(e.touches[0].pageX,e.touches[0].pageY,0),w[1].set(e.touches[0].pageX,e.touches[0].pageY,0),E.rotate(w[0].sub(t(w[0],g)).multiplyScalar(-E.rotationSpeed));break;case 2:w[0].set(e.touches[0].pageX,e.touches[0].pageY,0),w[1].set(e.touches[1].pageX,e.touches[1].pageY,0),distance=w[0].distanceTo(w[1]),E.zoom(new THREE.Vector3(0,0,H-distance)),H=distance;var o=w[0].clone().sub(t(w[0],g)),n=w[1].clone().sub(t(w[1],g));o.x=-o.x,n.x=-n.x,E.pan(o.add(n).multiplyScalar(.5))}g[0].copy(w[0]),g[1].copy(w[1])}}t=void 0!==t?t:document,this.enabled=!0,this.center=new THREE.Vector3,this.panSpeed=.001,this.zoomSpeed=.001,this.rotationSpeed=.005;var E=this,p=new THREE.Vector3,u={NONE:-1,ROTATE:0,ZOOM:1,PAN:2},d=u.NONE,v=this.center,l=new THREE.Matrix3,h=new THREE.Vector2,m=new THREE.Vector2,T=new THREE.Spherical,R={type:"change"};this.focus=function(t){var o=(new THREE.Box3).setFromObject(t);e.lookAt(v.copy(o.getCenter())),E.dispatchEvent(R)},this.pan=function(t){var o=e.position.distanceTo(v);t.multiplyScalar(o*E.panSpeed),t.applyMatrix3(l.getNormalMatrix(e.matrix)),e.position.add(t),v.add(t),E.dispatchEvent(R)},this.zoom=function(t){var o=e.position.distanceTo(v);t.multiplyScalar(o*E.zoomSpeed),t.length()>o||(t.applyMatrix3(l.getNormalMatrix(e.matrix)),e.position.add(t),E.dispatchEvent(R))},this.rotate=function(t){p.copy(e.position).sub(v),T.setFromVector3(p),T.theta+=t.x,T.phi+=t.y,T.makeSafe(),p.setFromSpherical(T),e.position.copy(v).add(p),e.lookAt(v),E.dispatchEvent(R)},this.dispose=function(){t.removeEventListener("contextmenu",i,!1),t.removeEventListener("mousedown",o,!1),t.removeEventListener("wheel",r,!1),t.removeEventListener("mousemove",n,!1),t.removeEventListener("mouseup",s,!1),t.removeEventListener("mouseout",s,!1),t.removeEventListener("dblclick",s,!1),t.removeEventListener("touchstart",c,!1),t.removeEventListener("touchmove",a,!1)},t.addEventListener("contextmenu",i,!1),t.addEventListener("mousedown",o,!1),t.addEventListener("wheel",r,!1);var w=(new THREE.Vector3,[new THREE.Vector3,new THREE.Vector3,new THREE.Vector3]),g=[new THREE.Vector3,new THREE.Vector3,new THREE.Vector3],H=null;t.addEventListener("touchstart",c,!1),t.addEventListener("touchmove",a,!1)},THREE.EditorControls.prototype=Object.create(THREE.EventDispatcher.prototype),THREE.EditorControls.prototype.constructor=THREE.EditorControls;