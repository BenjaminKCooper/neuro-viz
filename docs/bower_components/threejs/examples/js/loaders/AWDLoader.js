!function(){function t(){this.id=0,this.data=null}var r=1,e=2,s=3,a=4,i=5,h=6,n=7,o=8,d=21,p=23,u=41,c=42,l=43,_=44,U=45,f=46,b=47,g=21,v=23,F=4,T=5,m=7,y=8,k=!0;AWDProperties=function(){},AWDProperties.prototype={set:function(t,r){this[t]=r},get:function(t,r){return this.hasOwnProperty(t)?this[t]:r}},THREE.AWDLoader=function(r){this.manager=void 0!==r?r:THREE.DefaultLoadingManager,this.trunk=new THREE.Object3D,this.materialFactory=void 0,this._url="",this._baseDir="",this._data=void 0,this._ptr=0,this._version=[],this._streaming=!1,this._optimized_for_accuracy=!1,this._compression=0,this._bodylen=4294967295,this._blocks=[new t],this._accuracyMatrix=!1,this._accuracyGeo=!1,this._accuracyProps=!1},THREE.AWDLoader.prototype={constructor:THREE.AWDLoader,load:function(t,r,e,s){var a=this;this._url=t,this._baseDir=t.substr(0,t.lastIndexOf("/")+1);var i=new THREE.FileLoader(this.manager);i.setResponseType("arraybuffer"),i.load(t,function(t){r(a.parse(t))},e,s)},parse:function(t){var r=t.byteLength;for(this._ptr=0,this._data=new DataView(t),this._parseHeader(),0!=this._compression&&console.error("compressed AWD not supported"),this._streaming||this._bodylen==t.byteLength-this._ptr||console.error("AWDLoader: body len does not match file length",this._bodylen,r-this._ptr);this._ptr<r;)this.parseNextBlock();return this.trunk},parseNextBlock:function(){var r,e,s,a,i=this.readU32(),e=(this.readU8(),this.readU8()),s=(this.readU8(),this.readU32());switch(e){case 1:r=this.parseMeshData(s);break;case 22:r=this.parseContainer(s);break;case 23:r=this.parseMeshInstance(s);break;case 81:r=this.parseMaterial(s);break;case 82:r=this.parseTexture(s);break;case 101:r=this.parseSkeleton(s);break;case 112:r=this.parseMeshPoseAnimation(s,!1);break;case 113:r=this.parseVertexAnimationSet(s);break;case 102:r=this.parseSkeletonPose(s);break;case 103:r=this.parseSkeletonAnimation(s);break;case 122:r=this.parseAnimatorSet(s);break;default:this._ptr+=s}this._blocks[i]=a=new t,a.data=r,a.id=i},_parseHeader:function(){var t=this._version,r=this.readU8()<<16|this.readU8()<<8|this.readU8();if(4282180!=r)throw new Error("AWDLoader - bad magic");t[0]=this.readU8(),t[1]=this.readU8();var e=this.readU16();this._streaming=1==(1&e),2===t[0]&&1===t[1]&&(this._accuracyMatrix=2===(2&e),this._accuracyGeo=4===(4&e),this._accuracyProps=8===(8&e)),this._geoNrType=this._accuracyGeo?y:m,this._matrixNrType=this._accuracyMatrix?y:m,this._propsNrType=this._accuracyProps?y:m,this._optimized_for_accuracy=2===(2&e),this._compression=this.readU8(),this._bodylen=this.readU32()},parseContainer:function(t){var r,e=new THREE.Object3D,s=this.readU32(),a=this.parseMatrix4();return e.name=this.readUTF(),e.applyMatrix(a),r=this._blocks[s].data||this.trunk,r.add(e),this.parseProperties({1:this._matrixNrType,2:this._matrixNrType,3:this._matrixNrType,4:F}),e.extra=this.parseUserAttributes(),e},parseMeshInstance:function(t){var r,e,s,a,i,h,n,o,d,p,u,c,l,_,U;for(h=this.readU32(),o=this.parseMatrix4(),r=this.readUTF(),n=this.readU32(),c=this.readU16(),s=this.getBlock(n),d=[],l=0,U=0;U<c;U++)u=this.readU32(),p=this.getBlock(u),d.push(p);if(a=s.length,i=[],a>1)for(e=new THREE.Object3D,U=0;U<a;U++){var f=new THREE.Mesh(s[U]);i.push(f),e.add(f)}else e=new THREE.Mesh(s[0]),i.push(e);e.applyMatrix(o),e.name=r,_=this.getBlock(h)||this.trunk,_.add(e);var b=d.length,g=Math.max(a,b);for(U=0;U<g;U++)i[U%a].material=d[U%b];return this.parseProperties(null),e.extra=this.parseUserAttributes(),e},parseMaterial:function(t){var r,e,a,i,h,o,u;for(r=this.readUTF(),e=this.readU8(),o=this.readU8(),a=this.parseProperties({1:s,2:p,11:d,12:n,13:d}),u=0;u<o;){this.readU16();this.parseProperties(null),this.parseUserAttributes()}if(h=this.parseUserAttributes(),void 0!==this.materialFactory&&(i=this.materialFactory(r)))return i;if(i=new THREE.MeshPhongMaterial,1===e)i.color.setHex(a.get(1,13421772));else if(2===e){var c=a.get(2,0);i.map=this.getBlock(c)}return i.extra=h,i.alphaThreshold=a.get(12,0),i.repeat=a.get(13,!1),i},parseTexture:function(t){var r,e,s=(this.readUTF(),this.readU8());if(0===s){e=this.readU32();var a=this.readUTFBytes(e);console.log(a),r=this.loadTexture(a)}return this.parseProperties(null),this.parseUserAttributes(),r},loadTexture:function(t){var r=new THREE.Texture,e=new THREE.ImageLoader(this.manager);return e.load(this._baseDir+t,function(t){r.image=t,r.needsUpdate=!0}),r},parseSkeleton:function(t){var r=(this.readUTF(),this.readU16()),e=[],s=0;for(this.parseProperties(null);s<r;){var a,i;this.readU16(),a=new THREE.Bone,a.parent=this.readU16()-1,a.name=this.readUTF(),i=this.parseMatrix4(),a.skinMatrix=i,this.parseProperties(null),this.parseUserAttributes(),e.push(a),s++}return this.parseUserAttributes(),e},parseSkeletonPose:function(t){var r=(this.readUTF(),this.readU16());this.parseProperties(null);for(var e=[],s=0;s<r;){var a,i;a=this.readU8(),i=1===a?this.parseMatrix4():new THREE.Matrix4,e[s]=i,s++}return this.parseUserAttributes(),e},parseSkeletonAnimation:function(t){var r,e,s,a=(this.readUTF(),[]),i=this.readU16();this.parseProperties(null);for(var h=0;h<i;)e=this.readU32(),r=this.readU16(),s=this._blocks[e].data,a.push({pose:s,duration:r}),h++;if(0!==a.length)return this.parseUserAttributes(),a},parseVertexAnimationSet:function(t){for(var r,e=(this.readUTF(),this.readU16()),s=(this.parseProperties({1:T}),0),a=[];s<e;)r=this.readU32(),a.push(this._blocks[r].data),s++;return this.parseUserAttributes(),a},parseAnimatorSet:function(t){var r,e,s=(this.readUTF(),this.readU16()),a=this.parseProperties({1:v});r=this.readU32();for(var i=this.readU16(),h=[],n=0;n<i;n++)h.push(this.readU32());this.readU16(),Boolean(this.readU8());this.parseUserAttributes(),this.parseUserAttributes();var o=[];for(n=0;n<h.length;n++)o.push(this._blocks[h[n]].data);e=this._blocks[r].data;var d;for(1==s&&(d={animationSet:e,skeleton:this._blocks[a.get(1,0)].data}),n=0;n<o.length;n++)o[n].animator=d;return d},parseMeshData:function(t){var r,e,s,a=this.readUTF(),i=this.readU16(),h=0,n=[];for(e=this.parseProperties({1:this._geoNrType,2:this._geoNrType});h<i;){var o,d,p;for(r=new THREE.BufferGeometry,r.name=a,n.push(r),o=this.readU32(),d=this._ptr+o,this.parseProperties({1:this._geoNrType,2:this._geoNrType});this._ptr<d;){var u=0,c=this.readU8(),l=(this.readU8(),this.readU32()),_=l+this._ptr;if(1===c)for(s=new Float32Array(l/12*3),p=new THREE.BufferAttribute(s,3),r.addAttribute("position",p),u=0;this._ptr<_;)s[u]=-this.readF32(),s[u+1]=this.readF32(),s[u+2]=this.readF32(),u+=3;else if(2===c)for(s=new Uint16Array(l/2),p=new THREE.BufferAttribute(s,1),r.setIndex(p),u=0;this._ptr<_;)s[u+1]=this.readU16(),s[u]=this.readU16(),s[u+2]=this.readU16(),u+=3;else if(3===c)for(s=new Float32Array(l/8*2),p=new THREE.BufferAttribute(s,2),r.addAttribute("uv",p),u=0;this._ptr<_;)s[u]=this.readF32(),s[u+1]=1-this.readF32(),u+=2;else if(4===c)for(s=new Float32Array(l/12*3),p=new THREE.BufferAttribute(s,3),r.addAttribute("normal",p),u=0;this._ptr<_;)s[u]=-this.readF32(),s[u+1]=this.readF32(),s[u+2]=this.readF32(),u+=3;else this._ptr=_}this.parseUserAttributes(),r.computeBoundingSphere(),h++}return this.parseUserAttributes(),n},parseMeshPoseAnimation:function(t,r){var e,s,a,i,h,n,o,d,p,u,c=1,l=0,_={},U=[],f=(this.readUTF(),this.readU32()),b=this.getBlock(f);if(null===b)return void console.log("parseMeshPoseAnimation target mesh not found at:",f);for(o=b.geometry,o.morphTargets=[],r||(c=this.readU16()),e=this.readU16(),d=this.readU16(),p=0;p<d;)U.push(this.readU16()),p++;for(u=this.parseProperties({1:g,2:g}),_.looping=u.get(1,!0),_.stitchFinalFrame=u.get(2,!1),s=0;s<c;){for(i=this.readU16(),a=0;a<e;)for(p=0,h=this.readU32(),n=this._ptr+h;p<d;){if(1===U[p]){var v=new Float32Array(h/4);for(o.morphTargets.push({array:v}),l=0;this._ptr<n;)v[l]=this.readF32(),v[l+1]=this.readF32(),v[l+2]=this.readF32(),l+=3;a++}else this._ptr=n;p++}s++}return this.parseUserAttributes(),null},getBlock:function(t){return this._blocks[t].data},parseMatrix4:function(){var t=new THREE.Matrix4,r=t.elements;return r[0]=this.readF32(),r[1]=this.readF32(),r[2]=this.readF32(),r[3]=0,r[4]=this.readF32(),r[5]=this.readF32(),r[6]=this.readF32(),r[7]=0,r[8]=this.readF32(),r[9]=this.readF32(),r[10]=this.readF32(),r[11]=0,r[12]=-this.readF32(),r[13]=this.readF32(),r[14]=this.readF32(),r[15]=1,t},parseProperties:function(t){var r=this.readU32(),e=this._ptr+r,s=new AWDProperties;if(t)for(;this._ptr<e;){var a,i=this.readU16(),h=this.readU32();t.hasOwnProperty(i)?(a=t[i],s.set(i,this.parseAttrValue(a,h))):this._ptr+=h}return s},parseUserAttributes:function(){return this._ptr=this.readU32()+this._ptr,null},parseAttrValue:function(t,g){var v,F;switch(t){case r:v=1,F=this.readI8;break;case e:v=2,F=this.readI16;break;case s:v=4,F=this.readI32;break;case d:case a:v=1,F=this.readU8;break;case i:v=2,F=this.readU16;break;case h:case p:v=4,F=this.readU32;break;case n:v=4,F=this.readF32;break;case o:v=8,F=this.readF64;break;case u:case c:case l:case _:case U:case f:case b:v=8,F=this.readF64}if(v<g){var T,m,y;for(T=[],m=0,y=g/v;m<y;)T.push(F.call(this)),m++;return T}return F.call(this)},readU8:function(){return this._data.getUint8(this._ptr++)},readI8:function(){return this._data.getInt8(this._ptr++)},readU16:function(){var t=this._data.getUint16(this._ptr,k);return this._ptr+=2,t},readI16:function(){var t=this._data.getInt16(this._ptr,k);return this._ptr+=2,t},readU32:function(){var t=this._data.getUint32(this._ptr,k);return this._ptr+=4,t},readI32:function(){var t=this._data.getInt32(this._ptr,k);return this._ptr+=4,t},readF32:function(){var t=this._data.getFloat32(this._ptr,k);return this._ptr+=4,t},readF64:function(){var t=this._data.getFloat64(this._ptr,k);return this._ptr+=8,t},readUTF:function(){var t=this.readU16();return this.readUTFBytes(t)},readUTFBytes:function(t){for(var r=[],e=0;r.length<t;){var s=this._data.getUint8(this._ptr++,k);if(s<128)r[e++]=String.fromCharCode(s);else if(s>191&&s<224){var a=this._data.getUint8(this._ptr++,k);r[e++]=String.fromCharCode((31&s)<<6|63&a)}else{var a=this._data.getUint8(this._ptr++,k),i=this._data.getUint8(this._ptr++,k);r[e++]=String.fromCharCode((15&s)<<12|(63&a)<<6|63&i)}}return r.join("")}}}();