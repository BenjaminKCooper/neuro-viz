THREE.PLYLoader=function(e){this.manager=void 0!==e?e:THREE.DefaultLoadingManager,this.propertyNameMapping={}},THREE.PLYLoader.prototype={constructor:THREE.PLYLoader,load:function(e,t,n,r){var a=this,s=new THREE.FileLoader(this.manager);s.setResponseType("arraybuffer"),s.load(e,function(e){t(a.parse(e))},n,r)},setPropertyNameMapping:function(e){this.propertyNameMapping=e},parse:function(e){function t(e){var t=r(n(e));return"ascii"===t.format}function n(e){for(var t=new Uint8Array(e),n="",r=0;r<e.byteLength;r++)n+=String.fromCharCode(t[r]);return n}function r(e){function t(e,t){var n={type:e[0]};return"list"===n.type?(n.name=e[3],n.countType=e[1],n.itemType=e[2]):n.name=e[1],n.name in t&&(n.name=t[n.name]),n}var n=/ply([\s\S]*)end_header\s/,r="",a=0,s=n.exec(e);null!==s&&(r=s[1],a=s[0].length);for(var i,o,u,c={comments:[],elements:[],headerLength:a},l=r.split("\n"),f=0;f<l.length;f++){var p=l[f];if(p=p.trim(),""!==p)switch(u=p.split(/\s+/),o=u.shift(),p=u.join(" "),o){case"format":c.format=u[0],c.version=u[1];break;case"comment":c.comments.push(p);break;case"element":void 0!==i&&c.elements.push(i),i={},i.name=u[0],i.count=parseInt(u[1]),i.properties=[];break;case"property":i.properties.push(t(u,h.propertyNameMapping));break;default:console.log("unhandled",o,u)}}return void 0!==i&&c.elements.push(i),c}function a(e,t){switch(t){case"char":case"uchar":case"short":case"ushort":case"int":case"uint":case"int8":case"uint8":case"int16":case"uint16":case"int32":case"uint32":return parseInt(e);case"float":case"double":case"float32":case"float64":return parseFloat(e)}}function s(e,t){for(var n=t.split(/\s+/),r={},s=0;s<e.length;s++)if("list"===e[s].type){for(var i=[],o=a(n.shift(),e[s].countType),u=0;u<o;u++)i.push(a(n.shift(),e[s].itemType));r[e[s].name]=i}else r[e[s].name]=a(n.shift(),e[s].type);return r}function i(e){var t,n={indices:[],vertices:[],normals:[],uvs:[],colors:[]},a=r(e),i=/end_header\s([\s\S]*)$/,c="";null!==(t=i.exec(e))&&(c=t[1]);for(var l=c.split("\n"),f=0,p=0,h=0;h<l.length;h++){var m=l[h];if(m=m.trim(),""!==m){p>=a.elements[f].count&&(f++,p=0);var d=s(a.elements[f].properties,m);u(n,a.elements[f].name,d),p++}}return o(n)}function o(e){var t=new THREE.BufferGeometry;return t.setIndex(new(e.indices.length>65535?THREE.Uint32BufferAttribute:THREE.Uint16BufferAttribute)(e.indices,1)),t.addAttribute("position",new THREE.Float32BufferAttribute(e.vertices,3)),e.normals.length>0&&t.addAttribute("normal",new THREE.Float32BufferAttribute(e.normals,3)),e.uvs.length>0&&t.addAttribute("uv",new THREE.Float32BufferAttribute(e.uvs,2)),e.colors.length>0&&t.addAttribute("color",new THREE.Float32BufferAttribute(e.colors,3)),t.computeBoundingSphere(),t}function u(e,t,n){if("vertex"===t)e.vertices.push(n.x,n.y,n.z),"nx"in n&&"ny"in n&&"nz"in n&&e.normals.push(n.nx,n.ny,n.nz),"s"in n&&"t"in n&&e.uvs.push(n.s,n.t),"red"in n&&"green"in n&&"blue"in n&&e.colors.push(n.red/255,n.green/255,n.blue/255);else if("face"===t){var r=n.vertex_indices||n.vertex_index;3===r.length?e.indices.push(r[0],r[1],r[2]):4===r.length&&(e.indices.push(r[0],r[1],r[3]),e.indices.push(r[1],r[2],r[3]))}}function c(e,t,n,r){switch(n){case"int8":case"char":return[e.getInt8(t),1];case"uint8":case"uchar":return[e.getUint8(t),1];case"int16":case"short":return[e.getInt16(t,r),2];case"uint16":case"ushort":return[e.getUint16(t,r),2];case"int32":case"int":return[e.getInt32(t,r),4];case"uint32":case"uint":return[e.getUint32(t,r),4];case"float32":case"float":return[e.getFloat32(t,r),4];case"float64":case"double":return[e.getFloat64(t,r),8]}}function l(e,t,n,r){for(var a,s={},i=0,o=0;o<n.length;o++)if("list"===n[o].type){var u=[];a=c(e,t+i,n[o].countType,r);var l=a[0];i+=a[1];for(var f=0;f<l;f++)a=c(e,t+i,n[o].itemType,r),u.push(a[0]),i+=a[1];s[n[o].name]=u}else a=c(e,t+i,n[o].type,r),s[n[o].name]=a[0],i+=a[1];return[s,i]}function f(e){for(var t,a={indices:[],vertices:[],normals:[],uvs:[],colors:[]},s=r(n(e)),i="binary_little_endian"===s.format,c=new DataView(e,s.headerLength),f=0,p=0;p<s.elements.length;p++)for(var h=0;h<s.elements[p].count;h++){t=l(c,f,s.elements[p].properties,i),f+=t[1];var m=t[0];u(a,s.elements[p].name,m)}return o(a)}var p,h=this;return p=e instanceof ArrayBuffer?t(e)?i(n(e)):f(e):i(e)}};