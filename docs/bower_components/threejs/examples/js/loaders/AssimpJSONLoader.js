THREE.AssimpJSONLoader=function(e){this.manager=void 0!==e?e:THREE.DefaultLoadingManager},THREE.AssimpJSONLoader.prototype={constructor:THREE.AssimpJSONLoader,load:function(e,t,r,a){var n=this;this.texturePath=this.texturePath&&"string"==typeof this.texturePath?this.texturePath:this.extractUrlBase(e);var s=new THREE.FileLoader(this.manager);s.load(e,function(e){var r,s,i=JSON.parse(e);if(s=i.__metadata__,"undefined"!=typeof s){if("assimp2json"!==s.format)return void a("Not an assimp2json scene");if(s.version<100&&s.version>=200)return void a("Unsupported assimp2json file format version")}r=n.parse(i),t(r)},r,a)},setCrossOrigin:function(e){this.crossOrigin=e},setTexturePath:function(e){this.texturePath=e},extractUrlBase:function(e){var t=e.split("/");return t.pop(),(t.length<1?".":t.join("/"))+"/"},parse:function(e){var t=this.parseList(e.meshes,this.parseMesh),r=this.parseList(e.materials,this.parseMaterial);return this.parseObject(e,e.rootnode,t,r)},parseList:function(e,t){for(var r=new Array(e.length),a=0;a<e.length;++a)r[a]=t.call(this,e[a]);return r},parseMesh:function(e){var t,r,a,n=new THREE.BufferGeometry,s=[],i=e.vertices||[],o=e.normals||[],u=e.texturecoords||[],h=e.colors||[];for(u=u[0]||[],t=0,r=e.faces.length;t<r;t++)a=e.faces[t],s.push(a[0],a[1],a[2]);return n.setIndex(new(s.length>65535?THREE.Uint32BufferAttribute:THREE.Uint16BufferAttribute)(s,1)),n.addAttribute("position",new THREE.Float32BufferAttribute(i,3)),o.length>0&&n.addAttribute("normal",new THREE.Float32BufferAttribute(o,3)),u.length>0&&n.addAttribute("uv",new THREE.Float32BufferAttribute(u,2)),h.length>0&&n.addAttribute("color",new THREE.Float32BufferAttribute(h,3)),n.computeBoundingSphere(),n},parseMaterial:function(e){function t(e){var t=new THREE.Color;return t.setRGB(e[0],e[1],e[2]),t}function r(){var e=new Image;return e.width=1,e.height=1,new THREE.Texture(e)}var a,n,s=null,i=this,o=[],u={shading:THREE.SmoothShading};for(a in e.properties)n=e.properties[a],"$tex.file"===n.key?1!==n.semantic&&5!==n.semantic&&6!==n.semantic&&2!==n.semantic||!function(e){var t,r=new THREE.TextureLoader(i.manager);1===e?t="map":5===e?t="bumpMap":6===e?t="normalMap":2===e&&(t="specularMap"),o.push(t),r.setCrossOrigin(this.crossOrigin);var a=i.texturePath+"/"+n.value;a=a.replace(/\\/g,"/"),r.load(a,function(e){e&&(e.wrapS=e.wrapT=THREE.RepeatWrapping,s[t]=e,s.needsUpdate=!0)})}(n.semantic):"?mat.name"===n.key?u.name=n.value:"$clr.diffuse"===n.key?u.color=t(n.value):"$clr.specular"===n.key?u.specular=t(n.value):"$clr.emissive"===n.key?u.emissive=t(n.value):"$mat.shadingm"===n.key?1===n.value&&(u.shading=THREE.FlatShading):"$mat.shininess"===n.key&&(u.shininess=n.value);if(o.length)for(a=o.length-1;a>=0;--a)u[o[a]]=r();return s=new THREE.MeshPhongMaterial(u)},parseObject:function(e,t,r,a){var n,s,i=new THREE.Object3D;for(i.name=t.name||"",i.matrix=(new THREE.Matrix4).fromArray(t.transformation).transpose(),i.matrix.decompose(i.position,i.quaternion,i.scale),n=0;t.meshes&&n<t.meshes.length;++n)s=t.meshes[n],i.add(new THREE.Mesh(r[s],a[e.meshes[s].materialindex]));for(n=0;t.children&&n<t.children.length;++n)i.add(this.parseObject(e,t.children[n],r,a));return i}};