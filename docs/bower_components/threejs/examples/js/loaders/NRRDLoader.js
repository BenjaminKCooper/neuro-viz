THREE.NRRDLoader=function(r){this.manager=void 0!==r?r:THREE.DefaultLoadingManager},Object.assign(THREE.NRRDLoader.prototype,THREE.EventDispatcher.prototype,{load:function(r,e,t,n){var a=this,s=new THREE.FileLoader(a.manager);s.setResponseType("arraybuffer"),s.load(r,function(r){e(a.parse(r))},t,n)},parse:function(r){function e(r,e){void 0!==e&&null!==e||(e=1);var n=1,a=Uint8Array;switch(r){case"uchar":break;case"schar":a=Int8Array;break;case"ushort":a=Uint16Array,n=2;break;case"sshort":a=Int16Array,n=2;break;case"uint":a=Uint32Array,n=4;break;case"sint":a=Int32Array,n=4;break;case"float":a=Float32Array,n=4;break;case"complex":a=Float64Array,n=8;break;case"double":a=Float64Array,n=8}var s=new a(i.slice(o,o+=e*n));return c!=h&&(s=t(s,n)),1==e?s[0]:s}function t(r,e){for(var t=new Uint8Array(r.buffer,r.byteOffset,r.byteLength),n=0;n<r.byteLength;n+=e)for(var a=n+e-1,s=n;a>s;a--,s++){var i=t[s];t[s]=t[a],t[a]=i}return r}function n(r){var e,t,n,a,s,i,o,c,h;for(i=r.split(/\r?\n/),c=0,h=i.length;c<h;c++)s=i[c],s.match(/NRRD\d+/)?u.isNrrd=!0:s.match(/^#/)||(o=s.match(/(.*):(.*)/))&&(t=o[1].trim(),e=o[2].trim(),n=THREE.NRRDLoader.prototype.fieldFunctions[t],n?n.call(u,e):u[t]=e);if(!u.isNrrd)throw new Error("Not an NRRD file");if("bz2"===u.encoding||"bzip2"===u.encoding)throw new Error("Bzip is not supported");if(!u.vectors&&(u.vectors=[new THREE.Vector3(1,0,0),new THREE.Vector3(0,1,0),new THREE.Vector3(0,0,1)],u.spacings))for(a=0;a<=2;a++)isNaN(u.spacings[a])||u.vectors[a].multiplyScalar(u.spacings[a])}function a(r,e,t){var n="";e=e||0,t=t||r.length;var a,s=u.sizes.reduce(function(r,e){return r*e},1),i=10;"hex"===u.encoding&&(i=16);var o=new u.__array(s),c=0,h=parseInt;u.__array!==Float32Array&&u.__array!==Float64Array||(h=parseFloat);for(var p=e;p<t;p++)a=r[p],(a<9||a>13)&&32!==a?n+=String.fromCharCode(a):(""!==n&&(o[c]=h(n,i),c++),n="");return""!==n&&(o[c]=h(n,i),c++),o}var s,i=r,o=0,c=new Int8Array(new Int16Array([1]).buffer)[0]>0,h=!0,u={},p=e("uchar",r.byteLength),l=p.length,d=null,f=0;for(s=1;s<l;s++)if(10==p[s-1]&&10==p[s]){d=this.parseChars(p,0,s-2),f=s+1;break}n(d);var i=p.subarray(f);if("gzip"===u.encoding||"gz"===u.encoding){var g=new Zlib.Gunzip(new Uint8Array(i));i=g.decompress()}else if("ascii"===u.encoding||"text"===u.encoding||"txt"===u.encoding||"hex"===u.encoding)i=a(i);else if("raw"===u.encoding){for(var y=new Uint8Array(i.length),s=0;s<i.length;s++)y[s]=i[s];i=y}i=i.buffer;var v=new THREE.Volume;v.header=u,v.data=new u.__array(i);var w=v.computeMinMax(),E=w[0],b=w[1];v.windowLow=E,v.windowHigh=b,v.dimensions=[u.sizes[0],u.sizes[1],u.sizes[2]],v.xLength=v.dimensions[0],v.yLength=v.dimensions[1],v.zLength=v.dimensions[2];var _=new THREE.Vector3(u.vectors[0][0],u.vectors[0][1],u.vectors[0][2]).length(),R=new THREE.Vector3(u.vectors[1][0],u.vectors[1][1],u.vectors[1][2]).length(),m=new THREE.Vector3(u.vectors[2][0],u.vectors[2][1],u.vectors[2][2]).length();v.spacing=[_,R,m],v.matrix=new THREE.Matrix4;var A=1,T=1,x=1;if("left-posterior-superior"==u.space?(A=-1,T=-1):"left-anterior-superior"===u.space&&(A=-1),u.vectors){var k=u.vectors,H=u.space_origin;H||(H=[0,0,0]),v.matrix.set(A*k[0][0],A*k[1][0],A*k[2][0],0,T*k[0][1],T*k[1][1],T*k[2][1],0,x*k[0][2],x*k[1][2],x*k[2][2],0,0,0,0,1)}else v.matrix.set(A,0,0,0,0,T,0,0,0,0,x,0,0,0,0,1);return v.inverseMatrix=new THREE.Matrix4,v.inverseMatrix.getInverse(v.matrix),v.RASDimensions=new THREE.Vector3(v.xLength,v.yLength,v.zLength).applyMatrix4(v.matrix).round().toArray().map(Math.abs),v.lowerThreshold===-(1/0)&&(v.lowerThreshold=E),v.upperThreshold===1/0&&(v.upperThreshold=b),v},parseChars:function(r,e,t){void 0===e&&(e=0),void 0===t&&(t=r.length);var n="",a=0;for(a=e;a<t;++a)n+=String.fromCharCode(r[a]);return n},fieldFunctions:{type:function(r){switch(r){case"uchar":case"unsigned char":case"uint8":case"uint8_t":this.__array=Uint8Array;break;case"signed char":case"int8":case"int8_t":this.__array=Int8Array;break;case"short":case"short int":case"signed short":case"signed short int":case"int16":case"int16_t":this.__array=Int16Array;break;case"ushort":case"unsigned short":case"unsigned short int":case"uint16":case"uint16_t":this.__array=Uint16Array;break;case"int":case"signed int":case"int32":case"int32_t":this.__array=Int32Array;break;case"uint":case"unsigned int":case"uint32":case"uint32_t":this.__array=Uint32Array;break;case"float":this.__array=Float32Array;break;case"double":this.__array=Float64Array;break;default:throw new Error("Unsupported NRRD data type: "+r)}return this.type=r},endian:function(r){return this.endian=r},encoding:function(r){return this.encoding=r},dimension:function(r){return this.dim=parseInt(r,10)},sizes:function(r){var e;return this.sizes=function(){var t,n,a,s;for(a=r.split(/\s+/),s=[],t=0,n=a.length;t<n;t++)e=a[t],s.push(parseInt(e,10));return s}()},space:function(r){return this.space=r},"space origin":function(r){return this.space_origin=r.split("(")[1].split(")")[0].split(",")},"space directions":function(r){var e,t,n;return t=r.match(/\(.*?\)/g),this.vectors=function(){var r,a,s;for(s=[],r=0,a=t.length;r<a;r++)n=t[r],s.push(function(){var r,t,a,s;for(a=n.slice(1,-1).split(/,/),s=[],r=0,t=a.length;r<t;r++)e=a[r],s.push(parseFloat(e));return s}());return s}()},spacings:function(r){var e,t;return t=r.split(/\s+/),this.spacings=function(){var r,n,a;for(a=[],r=0,n=t.length;r<n;r++)e=t[r],a.push(parseFloat(e));return a}()}}});