THREE.TGALoader=function(e){this.manager=void 0!==e?e:THREE.DefaultLoadingManager},THREE.TGALoader.prototype.load=function(e,a,r,t){var o=this,i=new THREE.Texture,s=new THREE.FileLoader(this.manager);return s.setResponseType("arraybuffer"),s.load(e,function(e){i.image=o.parse(e),i.needsUpdate=!0,void 0!==a&&a(i)},r,t),i},THREE.TGALoader.prototype.parse=function(e){function a(e){switch(e.image_type){case p:case g:(e.colormap_length>256||24!==e.colormap_size||1!==e.colormap_type)&&console.error("THREE.TGALoader.parse.tgaCheckHeader: Invalid type colormap data for indexed type");break;case h:case f:case u:case E:e.colormap_type&&console.error("THREE.TGALoader.parse.tgaCheckHeader: Invalid type colormap data for colormap type");break;case l:console.error("THREE.TGALoader.parse.tgaCheckHeader: No data");default:console.error('THREE.TGALoader.parse.tgaCheckHeader: Invalid type " '+e.image_type+'"')}(e.width<=0||e.height<=0)&&console.error("THREE.TGALoader.parse.tgaCheckHeader: Invalid image size"),8!==e.pixel_size&&16!==e.pixel_size&&24!==e.pixel_size&&32!==e.pixel_size&&console.error('THREE.TGALoader.parse.tgaCheckHeader: Invalid pixel size "'+e.pixel_size+'"')}function r(e,a,r,t,o){var i,s,n,c;if(s=r.pixel_size>>3,n=r.width*r.height*s,a&&(c=o.subarray(t,t+=r.colormap_length*(r.colormap_size>>3))),e){i=new Uint8Array(n);for(var d,l,p,h=0,f=new Uint8Array(s);h<n;)if(d=o[t++],l=(127&d)+1,128&d){for(p=0;p<s;++p)f[p]=o[t++];for(p=0;p<l;++p)i.set(f,h+p*s);h+=s*l}else{for(l*=s,p=0;p<l;++p)i[h+p]=o[t++];h+=l}}else i=o.subarray(t,t+=a?r.width*r.height:n);return{pixel_data:i,palettes:c}}function t(e,a,r,t,o,i,s,n,c){var d,l,p,h=c,f=0,g=b.width;for(p=a;p!==t;p+=r)for(l=o;l!==s;l+=i,f++)d=n[f],e[4*(l+g*p)+3]=255,e[4*(l+g*p)+2]=h[3*d+0],e[4*(l+g*p)+1]=h[3*d+1],e[4*(l+g*p)+0]=h[3*d+2];return e}function o(e,a,r,t,o,i,s,n){var c,d,l,p=0,h=b.width;for(l=a;l!==t;l+=r)for(d=o;d!==s;d+=i,p+=2)c=n[p+0]+(n[p+1]<<8),e[4*(d+h*l)+0]=(31744&c)>>7,e[4*(d+h*l)+1]=(992&c)>>2,e[4*(d+h*l)+2]=(31&c)>>3,e[4*(d+h*l)+3]=32768&c?0:255;return e}function i(e,a,r,t,o,i,s,n){var c,d,l=0,p=b.width;for(d=a;d!==t;d+=r)for(c=o;c!==s;c+=i,l+=3)e[4*(c+p*d)+3]=255,e[4*(c+p*d)+2]=n[l+0],e[4*(c+p*d)+1]=n[l+1],e[4*(c+p*d)+0]=n[l+2];return e}function s(e,a,r,t,o,i,s,n){var c,d,l=0,p=b.width;for(d=a;d!==t;d+=r)for(c=o;c!==s;c+=i,l+=4)e[4*(c+p*d)+2]=n[l+0],e[4*(c+p*d)+1]=n[l+1],e[4*(c+p*d)+0]=n[l+2],e[4*(c+p*d)+3]=n[l+3];return e}function n(e,a,r,t,o,i,s,n){var c,d,l,p=0,h=b.width;for(l=a;l!==t;l+=r)for(d=o;d!==s;d+=i,p++)c=n[p],e[4*(d+h*l)+0]=c,e[4*(d+h*l)+1]=c,e[4*(d+h*l)+2]=c,e[4*(d+h*l)+3]=255;return e}function c(e,a,r,t,o,i,s,n){var c,d,l=0,p=b.width;for(d=a;d!==t;d+=r)for(c=o;c!==s;c+=i,l+=2)e[4*(c+p*d)+0]=n[l+0],e[4*(c+p*d)+1]=n[l+0],e[4*(c+p*d)+2]=n[l+0],e[4*(c+p*d)+3]=n[l+1];return e}function d(e,a,r,d,l){var p,h,f,g,u,E;switch((b.flags&T)>>_){default:case v:p=0,f=1,u=a,h=0,g=1,E=r;break;case m:p=0,f=1,u=a,h=r-1,g=-1,E=-1;break;case k:p=a-1,f=-1,u=-1,h=0,g=1,E=r;break;case w:p=a-1,f=-1,u=-1,h=r-1,g=-1,E=-1}if(x)switch(b.pixel_size){case 8:n(e,h,g,E,p,f,u,d);break;case 16:c(e,h,g,E,p,f,u,d);break;default:console.error("THREE.TGALoader.parse.getTgaRGBA: not support this format")}else switch(b.pixel_size){case 8:t(e,h,g,E,p,f,u,d,l);break;case 16:o(e,h,g,E,p,f,u,d);break;case 24:i(e,h,g,E,p,f,u,d);break;case 32:s(e,h,g,E,p,f,u,d);break;default:console.error("THREE.TGALoader.parse.getTgaRGBA: not support this format")}return e}var l=0,p=1,h=2,f=3,g=9,u=10,E=11,T=48,_=4,m=0,w=1,v=2,k=3;e.length<19&&console.error("THREE.TGALoader.parse: Not enough data to contain header.");var H=new Uint8Array(e),y=0,b={id_length:H[y++],colormap_type:H[y++],image_type:H[y++],colormap_index:H[y++]|H[y++]<<8,colormap_length:H[y++]|H[y++]<<8,colormap_size:H[y++],origin:[H[y++]|H[y++]<<8,H[y++]|H[y++]<<8],width:H[y++]|H[y++]<<8,height:H[y++]|H[y++]<<8,pixel_size:H[y++],flags:H[y++]};a(b),b.id_length+y>e.length&&console.error("THREE.TGALoader.parse: No data"),y+=b.id_length;var R=!1,A=!1,x=!1;switch(b.image_type){case g:R=!0,A=!0;break;case p:A=!0;break;case u:R=!0;break;case h:break;case E:R=!0,x=!0;break;case f:x=!0}var G=document.createElement("canvas");G.width=b.width,G.height=b.height;var L=G.getContext("2d"),z=L.createImageData(b.width,b.height),C=r(R,A,b,y,H);d(z.data,b.width,b.height,C.pixel_data,C.palettes);return L.putImageData(z,0,0),G};