<!DOCTYPE html><html lang="en"><head>
		<title>three.js webgl - clipping planes</title>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width,user-scalable=no,minimum-scale=1,maximum-scale=1">
		<style>
			body {
				margin: 0px;
				background-color: #000000;
				overflow: hidden;
			}
		</style>
	</head>
	<body>

		<script src="../build/three.js"></script>
		<script src="js/controls/OrbitControls.js"></script>

		<script src="js/libs/stats.min.js"></script>
		<script src="js/libs/dat.gui.min.js"></script>

		<script>function planesFromMesh(e,a){for(var n=a.length/3,t=new Array(n),r=0,i=0;r<n;++r,i+=3){var o=e[a[i]],l=e[a[i+1]],s=e[a[i+2]];t[r]=(new THREE.Plane).setFromCoplanarPoints(o,l,s)}return t}function createPlanes(e){for(var a=new Array(e),n=0;n!==e;++n)a[n]=new THREE.Plane;return a}function assignTransformedPlanes(e,a,n){for(var t=0,r=a.length;t!==r;++t)e[t].copy(a[t]).applyMatrix4(n)}function cylindricalPlanes(e,a){for(var n=createPlanes(e),t=0;t!==e;++t){var r=n[t],i=t*Math.PI*2/e;r.normal.set(Math.cos(i),0,Math.sin(i)),r.constant=a}return n}function init(){camera=new THREE.PerspectiveCamera(36,window.innerWidth/window.innerHeight,.25,16),camera.position.set(0,1.5,3),scene=new THREE.Scene,scene.add(new THREE.AmbientLight(5263440));var e=new THREE.SpotLight(16777215);e.angle=Math.PI/5,e.penumbra=.2,e.position.set(2,3,3),e.castShadow=!0,e.shadow.camera.near=3,e.shadow.camera.far=10,e.shadow.mapSize.width=1024,e.shadow.mapSize.height=1024,scene.add(e);var a=new THREE.DirectionalLight(5591130,1);a.position.set(0,2,0),a.castShadow=!0,a.shadow.camera.near=1,a.shadow.camera.far=10,a.shadow.camera.right=1,a.shadow.camera.left=-1,a.shadow.camera.top=1,a.shadow.camera.bottom=-1,a.shadow.mapSize.width=1024,a.shadow.mapSize.height=1024,scene.add(a),clipMaterial=new THREE.MeshPhongMaterial({color:15600144,shininess:100,side:THREE.DoubleSide,clippingPlanes:createPlanes(Planes.length),clipShadows:!0}),object=new THREE.Group;for(var n=new THREE.BoxBufferGeometry(.18,.18,.18),t=-2;t<=2;++t)for(var r=-2;r<=2;++r)for(var i=-2;i<=2;++i){var o=new THREE.Mesh(n,clipMaterial);o.position.set(i/5,r/5,t/5),o.castShadow=!0,object.add(o)}scene.add(object);var l=new THREE.PlaneBufferGeometry(3,3,1,1),s=new THREE.Color;volumeVisualization=new THREE.Group,volumeVisualization.visible=!1;for(var c=0,d=Planes.length;c!==d;++c){var p=new THREE.MeshBasicMaterial({color:s.setHSL(c/d,.5,.5).getHex(),side:THREE.DoubleSide,opacity:.2,transparent:!0,clippingPlanes:clipMaterial.clippingPlanes.filter(function(e,a){return a!==c})});volumeVisualization.add(new THREE.Mesh(l,p))}scene.add(volumeVisualization);var w=new THREE.Mesh(l,new THREE.MeshPhongMaterial({color:10530223,shininess:150}));w.rotation.x=-Math.PI/2,w.scale.multiplyScalar(3),w.receiveShadow=!0,scene.add(w);var m=document.body;renderer=new THREE.WebGLRenderer,renderer.shadowMap.enabled=!0,renderer.shadowMap.renderSingleSided=!1,renderer.setPixelRatio(window.devicePixelRatio),renderer.setSize(window.innerWidth,window.innerHeight),window.addEventListener("resize",onWindowResize,!1),m.appendChild(renderer.domElement),globalClippingPlanes=createPlanes(GlobalClippingPlanes.length),renderer.clippingPlanes=Empty,renderer.localClippingEnabled=!0,stats=new Stats,m.appendChild(stats.dom);var E=new THREE.OrbitControls(camera,renderer.domElement);E.target.set(0,1,0),E.update();var h=new dat.GUI,u=h.addFolder("Local Clipping"),b={get"Enabled"(){return renderer.localClippingEnabled},set"Enabled"(e){renderer.localClippingEnabled=e,e||(volumeVisualization.visible=!1)},get"Shadows"(){return clipMaterial.clipShadows},set"Shadows"(e){clipMaterial.clipShadows=e},get"Visualize"(){return volumeVisualization.visible},set"Visualize"(e){renderer.localClippingEnabled&&(volumeVisualization.visible=e)}};u.add(b,"Enabled"),u.add(b,"Shadows"),u.add(b,"Visualize").listen(),h.addFolder("Global Clipping").add({get"Enabled"(){return renderer.clippingPlanes!==Empty},set"Enabled"(e){renderer.clippingPlanes=e?globalClippingPlanes:Empty}},"Enabled"),startTime=Date.now()}function onWindowResize(){camera.aspect=window.innerWidth/window.innerHeight,camera.updateProjectionMatrix(),renderer.setSize(window.innerWidth,window.innerHeight)}function setObjectWorldMatrix(e,a){var n=e.parent;scene.updateMatrixWorld(),e.matrix.getInverse(n.matrixWorld),e.applyMatrix(a)}function animate(){var e=Date.now(),a=(e-startTime)/1e3;requestAnimationFrame(animate),object.position.y=1,object.rotation.x=.5*a,object.rotation.y=.2*a,object.updateMatrix(),transform.copy(object.matrix);var n=.5*Math.cos(.5*a)+.7;transform.multiply(tmpMatrix.makeScale(n,n,n)),assignTransformedPlanes(clipMaterial.clippingPlanes,Planes,transform);for(var t=volumeVisualization.children,r=0,i=t.length;r!==i;++r)tmpMatrix.multiplyMatrices(transform,PlaneMatrices[r]),setObjectWorldMatrix(t[r],tmpMatrix);transform.makeRotationY(.1*a),assignTransformedPlanes(globalClippingPlanes,GlobalClippingPlanes,transform),stats.begin(),renderer.render(scene,camera),stats.end()}var planeToMatrix=function(){var e=new THREE.Vector3,a=new THREE.Vector3,n=new THREE.Vector3;return function(t){var r=t.normal,i=new THREE.Matrix4;return Math.abs(r.x)>Math.abs(r.z)?a.set(-r.y,r.x,0):a.set(0,-r.z,r.y),e.crossVectors(a.normalize(),r),t.coplanarPoint(n),i.set(e.x,a.x,r.x,n.x,e.y,a.y,r.y,n.y,e.z,a.z,r.z,n.z,0,0,0,1)}}(),Vertices=[new THREE.Vector3(1,0,+Math.SQRT1_2),new THREE.Vector3(-1,0,+Math.SQRT1_2),new THREE.Vector3(0,1,-Math.SQRT1_2),new THREE.Vector3(0,-1,-Math.SQRT1_2)],Indices=[0,1,2,0,2,3,0,3,1,1,3,2],Planes=planesFromMesh(Vertices,Indices),PlaneMatrices=Planes.map(planeToMatrix),GlobalClippingPlanes=cylindricalPlanes(5,3.5),Empty=Object.freeze([]),camera,scene,renderer,startTime,stats,object,clipMaterial,volumeVisualization,globalClippingPlanes,transform=new THREE.Matrix4,tmpMatrix=new THREE.Matrix4;init(),animate();</script>

	

</body></html>